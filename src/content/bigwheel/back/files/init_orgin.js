Date.prototype.Format=function(a){var c={"M+":this.getMonth()+1,"d+":this.getDate(),"H+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};if(/(y+)/.test(a)){a=a.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))}for(var b in c){if(new RegExp("("+b+")").test(a)){a=a.replace(RegExp.$1,(RegExp.$1.length==1)?(c[b]):(("00"+c[b]).substr((""+c[b]).length)))}}return a};function toThousands(b){var b=(b||0).toString(),a="";while(b.length>3){a=","+b.slice(-3)+a;b=b.slice(0,b.length-3)}if(b){a=b+a}return a}var getAwardName=function(b){b=parseInt(b);switch(b){case 1:return"奖项一";case 2:return"奖项二";case 3:return"奖项三";case 4:return"奖项四";case 5:return"奖项五";case 6:return"奖项六";case 7:return"奖项七";case 8:return"奖项八"}};$.htmlEncode=function(a){return a.replace(/&/g,"&amp;").replace(/ /g,"&nbsp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br />").replace(/"/g,"&quot;").replace(/'/g,"&#39;")};$.htmlDecode=function(a){return a.replace(/&#39;/g,"'").replace(/<[Bb][Rr]\s*(\/)?\s*>/g,"\n").replace(/&nbsp;/g," ").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&amp;/g,"&")};$.htmlFilter=function(a){return a==null?"":a.replace(/<\s*\/?[^>]*\s*>/g,"").replace(/"/g,"")};var initCitySelector=function(){var a=aSelect({data:aLocation,default_text:"不限制"});a.bind("#addr_prov","0");a.bind("#addr_city","0")};function afterPreviewWinLoad(d){if(window.afterInitLoadFn&&typeof window.afterInitLoadFn=="function"){window.afterInitLoadFn(d)}if(window.save_addressList){console.log(window.save_addressList);pageData.addressList=JSON.parse(window.save_addressList);renderAddressList(pageData.addressList);renderAddressText(pageData.addressList);$("#show_add_area_new").hide();$("#show_view_area_list").show()}if(window.templateId==14){$("#set_actlimit_box").find(".radio.inline").eq(0).hide();$("input[name='totalLotteryCount']").attr("disabled","disabled");$("input[name='dayLotteryCount']").attr("disabled","disabled");$("input[name='singleUserAwards']").attr("disabled","disabled");$("#set_probabilityType_box").hide()}if(_isZqJiZi){$(".del_award_tab_item").hide();$(".add_award_tab_item").hide()}if(_isJiWuFu){$(".del_award_tab_item").hide();$(".add_award_tab_item").hide()}if(_isNewBargain){$(".del_award_tab_item").hide();$(".add_award_tab_item").hide();$("#totalLength_tooltip").popover({title:"什么是拿奖总距离",trigger:"hover",content:"用于活动页面中显示，影响用户助力的次数，限制距离为1～300的整数。"});$("#elongation_tooltip").popover({title:"什么是单次拿奖伸长距离范围",trigger:"hover",content:"好友拿奖的“手”伸长的距离范围，影响用户拿奖的速度与邀请好友的人数，建议根据拿奖总距离与单次拿奖缩短距离酌情设置。"});$("#shorten_tooltip").popover({title:"什么是单次拿奖缩短距离范围",trigger:"hover",content:"好友拿奖的“手”缩短的距离范围，影响用户拿奖的速度与邀请好友的人数，建议根据拿奖总距离与单次拿奖伸长距离范围酌情设置。"})}if(_isZqPinTu){$("#helpType").val(5);$("#helpCount").removeAttr("disabled");$(".helpType_1_cont").hide();$(".helpType_2_cont").hide();$("#set_helpType_box").show();$("#set_actlimit_box").find(".radio.inline").eq(0).hide();$("input[name='totalLotteryCount']").attr("disabled","disabled");$("input[name='dayLotteryCount']").attr("disabled","disabled");$("input[name='singleUserAwards']").attr("disabled","disabled")}if(_isZqBoBing){$("#helpType").val(5);$("#helpCount").val(5);$(".del_award_tab_item").hide();$(".add_award_tab_item").hide();if(isEdit){$(".award_tab select[name='awardType']").val(2).attr("disabled","disabled")}else{$(".award_tab select[name='awardType']").val(2).change().attr("disabled","disabled")}}if(_isGuangGun){$("#form_play_help").hide();$("#adv_subtab>li").eq(2).hide();$("#adv_subtab_3").hide()}if(_isWanSheng||_isQiangHuo||_isFuDan||_isTruthOrDare){$("#form_play_help").hide();$("#adv_subtab>li").eq(2).hide();$("#adv_subtab_3").hide()}if(_isNewPzhb){$("#set_awardSendType_box").hide();$("#set_minscore_box").hide();$("#set_singleUserAwards_box #singleUserAwards").attr("disabled","disabled");$("#set_withHelp_box #withHelp").attr("disabled","disabled");$("input[name='totalLotteryCount']").attr("disabled","disabled");$("input[name='dayLotteryCount']").attr("disabled","disabled");$(".helpType_1_cont #helpEffectForHelp").attr("checked","checked").closest("label").addClass("single-radio");$(".helpType_1_cont #helpEffectForHelp").trigger("change");$(".helpType_1_cont #helpEffectForAddPlayCount").closest("label").hide();$("#adv_subtab_3 .controls").eq(0).hide();$("#adv_subtab_3 label").eq(0).hide();$("#adv_subtab_2 [name='shareType']:eq(0)").click();$("#adv_subtab_2 [name='shareType']:eq(1)").closest("label").hide();$("#sharetype_tooltip").hide();if(hasPublish){$("input[data-editable='false']").attr("disabled","disabled")}}if(_isNewZrhb){$("#set_daylimit_box .help-inline").hide();$("#set_daylimit_box br").hide();$("#set_awardSendType_box").hide();$("#set_minscore_box").hide();$("#set_withHelp_box #withHelp").attr("disabled","disabled");$(".helpType_1_cont #helpEffectForHelp").attr("checked","checked").closest("label").addClass("single-radio");$(".helpType_1_cont #helpEffectForHelp").trigger("change");$(".helpType_1_cont #helpEffectForAddPlayCount").closest("label").hide();onlySupportImgShareType();$("#adv_subtab_content #set_logo_box").hide();if(hasPublish){$("input[data-editable='false']").attr("disabled","disabled")}}if(_isThreeDPan){$("#adv_subtab_2 .control-group .controls").find(".radio.inline").eq(0).hide();$("#adv_subtab_2 .control-group .controls").find(".radio.inline").eq(1).show();$("#adv_subtab_2 [name='shareType']:eq(1)").click();$("#sharetype_tooltip").hide();$("#set_withHelp_box #withHelp").removeAttr("checked")}if(_isFromHb){if(isEdit){$(".award_tab select[name='awardType']").val(2).trigger("change").attr("disabled","disabled")}else{$(".award_tab select[name='awardType']").val(2).trigger("change").attr("disabled","disabled")}}if(_isShakeRedEnvelope){if(isEdit){$(".award_tab select[name='awardType']").val(2).attr("disabled","disabled")}else{$(".award_tab select[name='awardType']").val(2).change().attr("disabled","disabled")}$("#dayLotteryCount").attr("disabled","disabled")}if(_isValuationHunter){$("#singleUserAwards").val(2).attr("disabled","disabled");$("#set_probabilityType_box").hide();$("#dayLotteryCount").attr("disabled","disabled");$("#set_actlimit_box").find(".inline").eq(0).hide();$("input[name='totalLotteryCountRadio']").eq(1).trigger("click");$("#set_actlimit_box").find(".control-label").text("单人总估价机会");$("#set_actaward_box").find(".award_tab_item").find("li").hide();$("#set_actaward_box").find(".award_tab_item").find("li").eq(0).show();if(isEdit){$(".award_tab select[name='awardType']").val(2).attr("disabled","disabled")}else{$(".award_tab select[name='awardType']").val(2).change().attr("disabled","disabled")}}if(_isNewShakeRedpack){$("#set_awardSendType_box").hide();$("#set_daylimit_box .help-inline").hide();$("#set_daylimit_box br").hide();$("#set_minscore_box").hide();hideHelpEffect();onlySupportArticleShareType();$(".config_view #game_setting_tab").hide();hideLogo();if(hasPublish){$("input[data-editable='false']").attr("disabled","disabled")}}if(_isXiuyixiu){$("#set_awardSendType_box").hide();$("#set_minscore_box").hide();hideHelpEffect();onlySupportArticleShareType();$(".config_view #game_setting_tab").hide();hideLogo();$$(".game-subtitle span").text($(".award_tab_content input[name=trophyName]").eq(0).val());$(".award_tab_content input[name=trophyName]").eq(0).keyup(function(f){$$(".game-subtitle span").text($(f.target).val())});$("#set_globalAwardVirtualNum_box").show();$("#set_daylimit_box .help-inline").hide();$("#lucky_award_box br").remove()}if(_isExciteLottery){$("#set_participant_box input[name=hideParticipant]").click();$("#set_participant_box").hide();$("#set_awardSendType_box").hide();$("#set_daylimit_box .help-inline").hide();$("#lucky_award_box br").remove();$("#set_minscore_box").hide();hideHelpEffect();hideLogo();hideGameSetting();onlySupportArticleShareType()}if(_isKlhb){$("#set_awardSendType_box").hide();$("#set_actlimit_box").hide();$("#set_daylimit_box").hide();$("#set_minscore_box").hide();$("#set_singleUserAwards_box #singleUserAwards").attr("disabled","disabled");$("#set_globalProbability_box #globalProbability").val(100).attr("disabled","disabled");$("#set_probabilityType_box").hide();hideHelpEffect();hideLogo();onlySupportArticleShareType();hideGameSetting();$("#set_globalProbability_box").find(".help-inline").hide();$("#lucky_award_box #globalProbability").val(100);$("#lucky_award_box #set_probabilityMode_box").hide()}if(_isBigWheel){}if(_isNewYyhb){$("#set_awardSendType_box").hide();$('input:radio[name="totalLotteryCountRadio"]').eq(1).attr("checked","checked");$('input:radio[name="totalLotteryCountRadio"]').eq(0).closest("label").hide();$("#totalLotteryCount").attr("disabled",false);$("#helpEffectForHelp").closest(".radio").hide();onlySupportImgShareType();hideGameSetting();$("#helpEffectForHelp").hide();var e=$(".award_tab select[name='awardType']");if(isEdit){e.val(2);var c=d.model.records.awardBindPrizes;for(var a=0;a<c.length;a++){var b=c[a];if(b.award.deleted){e.eq(a).change()}}e.attr("disabled","disabled")}else{e.val(2).change().attr("disabled","disabled")}}if(_isYyttl){$("input[name='totalLotteryCountRadio']").eq(1).closest("label").hide();$("#set_globalProbability_box #globalProbability").val(100).attr("disabled","disabled");$("#probabilityType").closest("label").hide();$("#set_globalProbability_box").hide();$("#set_singleUserAwards_box").hide();$("#set_minscore_box").hide();$("#set_awardSendType_box").hide();$("#game_setting_tab").hide();$(".del_award_tab_item").hide();$(".add_award_tab_item").hide();hideLogo();onlySupportImgShareType();$("input[name='helpEffect']").eq(1).closest(".radio").hide();$("input[name='helpEffect']").eq(1).hide();$("input[name='totalLotteryCountRadio']").eq(0).closest(".controls").css({"margin-top":"9px"});$("#globalProbability").val(100).attr("disabled","disabled");if(isEdit){$(".award_tab select[name='awardType']").val(2).attr("disabled","disabled");$("#add_redpack_num").closest(".control-group").hide()}else{$(".award_tab select[name='awardType']").val(2).change().attr("disabled","disabled")}$("input[name='awardRealNum']").attr("disabled","disabled");$(".redpack_award_type").hide();$("#add_redpack_num").val(1);$("#form_add_redpack_setting .add_redpack_num").hide();$(".set_defaultWinner_box").hide();yyttlUpdateWithdrawPersonCount();yyttlBindWithdrawEvent()}if(_isAbsolutelyBigWheel){$("#withHelp").attr("checked","checked").attr("disabled","disabled");$("#other_cgroup").find("input").attr("disabled","disabled")}if(_isZcqc){$(".del_award_tab_item").hide();$(".add_award_tab_item").hide();hideLogo();hideGameSetting();onlySupportRedpack();hideParticipant();hideDefaultWinner();hideSecurity();hideHelpEffect();$("#set_probabilityMode_box .help-inline").hide();$("input[name='participateLimit']").closest(".control-group").hide();$("input[name='blacklist']").eq(1).attr("checked","checked");$("input[name='blacklist']").closest(".control-group").hide();$("input[name='securityLevel']").eq(0).attr("checked","checked");$("#award_detail_form_0 .control-group").eq(2).hide()}if(window.templateId==37){$("input[name='singleUserAwards']").attr("disabled","disabled")}initQrcodeBindPage();$(".topBar").find(".column").each(function(f,g){if($(g).find(".name").html()=="游戏环节"){$(g).click();return}});$(".mp_loading_cover").hide();$(".mp_loading_clip").hide();$$(".award_detail_view_tip").show()}function yyttlBindWithdrawEvent(){var b=$(".yyttl-withdraw").eq(0);var a=b.find("input[name=withdrawThresholdRadio]");a.change(function(){yyttlUpdateWithdrawPersonCount()});b.find(".withdrawThreshold_Min").keyup(function(){yyttlUpdateWithdrawPersonCount()});$(".yyttl-withdraw-max .withdrawThreshold_Max").keyup(function(){yyttlUpdateWithdrawPersonCount()});$(".trophy_redpack_text").eq(0).find("input[name=totalCount]").keyup(function(){yyttlUpdateWithdrawPersonCount()})}function yyttlUpdateWithdrawPersonCount(){var e=$(".yyttl-withdraw").eq(0);var c=e.find("input[name=withdrawThresholdRadio]:checked").val();var b=Number($('input[name="totalCount"]').val());var d=Number($(".withdrawThreshold_Min").val());var a=Number($(".withdrawThreshold_Max").val());var f=Math.floor(b/((d+a)/2));if(c==1){f=Math.floor(b/((a+1)/2));$("#may_act").html(f+"人");$("input[name='awardRealNum']").val(f);$("#smsfreeze_total").html(f)}else{if(c==3){f=Math.floor(b/((a+3)/2));$("#may_act").html(f+"人");$("input[name='awardRealNum']").val(f);$("#smsfreeze_total").html(f)}else{$("#may_act").html(f+"人");$("input[name='awardRealNum']").val(f);$("#smsfreeze_total").html(f)}}}function onlySupportRedpack(){$(".award_tab select[name='awardType']").val(2).trigger("change").attr("disabled","disabled")}function onlySupportArticleShareType(){$("#adv_subtab_2 [name='shareType']:eq(1)").click();$("#adv_subtab_2 [name='shareType']:eq(1)").closest("label").addClass("single-radio");$("#adv_subtab_2 [name='shareType']:eq(0)").closest("label").hide();$("#sharetype_tooltip").hide()}function onlySupportImgShareType(){$("#adv_subtab_2 [name='shareType']:eq(0)").click();$("#adv_subtab_2 [name='shareType']:eq(1)").closest("label").hide();$("#sharetype_tooltip").hide()}function onlySupportQrcodeShareType(){$("#adv_subtab_2 [name='shareType']:eq(1)").click();$("#adv_subtab_2 [name='shareType']:eq(0)").closest("label").hide();$("#sharetype_tooltip").hide()}function hideHelpEffect(){$("#set_withHelp_box #withHelp").removeAttr("checked");$("#set_withHelp_box").hide();$(".helpType_1_cont").closest(".control-group").hide()}function hideLogo(){$("#adv_subtab_content #set_logo_box").hide()}function hideCopyright(){$("#set_copyright_box").hide()}function hideGameSetting(){$(".config_view #game_setting_tab").hide()}function hideParticipant(){$("#set_participant_box input[name=hideParticipant]:eq(1)").attr("checked","checked");$("#set_participant_box").hide()}function hideDefaultWinner(){$(".award_detail_form .set_defaultWinner_box").hide()}function hideSecurity(){$("#securityLevel_2_tips").hide();$("#security_choice_group").hide()}var load_default_template=function(d){var e={items:[]};for(var c=0;c<8;c++){var b=getTrophyName(1,c);e.items.push({index:c+1,hidden:c>((_isZqJiZi||_isZqBoBing||_isNewBargain||_isJiWuFu||_isGuangGun||_isWanSheng||_isYyttl||_isZcqc||_isValuationHunter)?0:2),awardName:HdGame.getLevelName(c+1),operationTip:"凭券联系现场工作人员兑奖",storeAddress:"请填写您的兑奖地址或者门店地址",trophyName:b,integralConvert:8-c})}hasPublish=false;var g=new Date().getTime();var a=g+7*24*60*60*1000;$("#startDate").val(new Date(g).Format("yyyy-MM-dd HH:mm:ss"));$("#endDate").val(new Date(a).Format("yyyy-MM-dd HH:mm:ss"));if(_isZcqc){$("#startTime").timepicker({ampm:true,hourMin:6,hourMax:9,timeFormat:"hh:mm"}).val("06:00");$("#endTime").timepicker({ampm:true,hourMin:6,hourMax:9,timeFormat:"hh:mm"}).val("06:15")}load_award_tab(e);$("input[name='validityStart']").val(new Date().Format("yyyy-MM-dd HH:mm:ss"));$("input[name='validityStop']").val(new Date(a).Format("yyyy-MM-dd HH:mm:ss"));$("input[name='validityStart']").datetimepicker();var f=new Date().getTime($("#validityStart").val());$("input[name='validityStop']").datetimepicker({minDate:new Date(f)});$.ajax({url:"./zp_files/zhp1.html",timeout:15000,dataType:"json",data:{id:pageTemplateId,uid:global_uid},success:function(i){if(i.ret==0){var j=i.model.records;console.log(i);window.actGamePagePath=j.path;$("#actName").text(j.activityName);$("input[name='title']").val(j.activityName);$("input[name='gameTime']").val(j.gameTime);$("input[name='passCondition']").val(j.passThreshhold);$("input[name='totalLotteryCount']").val(j.totalLotteryCount);$("input[name='dayLotteryCount']").val(j.dayLotteryCount);$("input[name='singleUserAwards']").val(j.singleUserAwards);if(j.limitLottery){$("input[name='totalLotteryCountRadio']").eq(1).attr("checked","checked")}$("textarea[name='ruleTips']").val(j.activityRule);$("#helpType").val(j.helpType);if(j.helpType==1){$(".helpType_1_cont").show();$(".helpType_2_cont").hide()}else{$(".helpType_1_cont").hide();$(".helpType_2_cont").show()}$("input[name='shareType']").eq(0).attr("checked","checked").trigger("change");$("input[name='probabilityMode']").eq(0).attr("checked","checked").trigger("change");$("input[name='awardSendType']").eq(j.helpType==1?0:1).attr("checked","checked");$("#organizerLogo").val(static_res_prefix+"/content/bigwheel/back/files/lot/organizer_logo.jpg");$("#openClickPic").val(static_res_prefix+"/content/bigwheel/back/files/lot/open_click_btn.png");$("input[name='securityLevel'][value='2']").attr("checked","checked").trigger("change");var h=setInterval(function(){if(previewWinHasLoad){try{$("#ruleTips").trigger("keyup");$("#globalProbability").trigger("keyup");$("#initialProbability").trigger("keyup");$("#helpProbability").trigger("keyup");$("#helpNum").trigger("keyup");$("#organizer").trigger("keyup");$("#startDate").trigger("change");$("#passCondition").trigger("keyup");$("input[name='awardName']").eq(0).trigger("keyup");$("input[name='awardSendType']").trigger("change");if($("#set_bless_box").length>0){$("#bless").trigger("keyup")}if($("#set_seller_name_box").length>0){$("#seller_name").trigger("keyup")}triggerAwardDetailPhoneTxt(true);afterPreviewWinLoad();var k=$('<div data-index="0" class="myprize_item s0"><p class="award_name">'+$("input[name='awardName']").eq(0).val()+'</p><p class="expired_time">'+$("input[name='trophyName']").eq(0).val()+'</p><p class="exchange_statu">未领取<p></div>');$$(".fire_rule .myprize_list_cont").prepend(k);window.clearInterval(h)}catch(l){window.clearInterval(h);console&&console.error(l)}}initBecomeGrey()},200)}},error:function(h,j,i){alert("服务器正在紧张的运行中，请稍后再试")}})};var load_activity=function(a){$.ajax({url:"/admin/new_activity/getActivityWithAllInfoAndGamePage",timeout:15000,dataType:"json",data:{aid:a,uid:global_uid},success:function(W){if(W.ret==0){if(W.model.records.awardSendType==2){$("#set_probabilityMode_box .controls:eq(1),#set_probabilityMode_box .probabilityInfo").hide()}if(W.model.total<=0){alert("您查询的活动不存在");return}console.log(W);var f=W.model.records.activity;window.activityJson=f;window.activityJson.aidEncrypt=W.model.aidEncrypt;var U=W.model.records.imgTextShare;window.actPageId=f.pageId;var N=f.extraData;if(getPreviewWin().Edit&&getPreviewWin().Edit.originDef){var k=$.parseJSON(W.model.records.gamePage.jsonContent);console.log("gamePageJson："+k)}$("#actName").text(f.title);$("#title").val(f.title);$("#startDate").val(new Date(f.start).Format("yyyy-MM-dd HH:mm:ss"));$("#endDate").val(new Date(f.end).Format("yyyy-MM-dd HH:mm:ss"));$("#ruleTips").val(f.ruleTips);$("#organizer").val(f.organizer);$("input[name='showDanmu']").eq((N&(Math.pow(2,11)))==0?1:0).attr("checked","checked");$("#organizerLink").val(f.organizerLink);$("input[name='hideOrganizerLogo']").eq(f.hideOrganizerLogo?0:1).attr("checked","checked");if(f.hideOrganizerLogo){$(".orgLogoControls").hide().find("input").attr("disabled","disabled")}else{$(".orgLogoControls").show().find("input").removeAttr("disabled");if(f.organizerLogo.indexOf("http")==-1){$(".orgLogoControls .thumb_img").attr("src",user_img_domain+f.organizerLogo)}else{$(".orgLogoControls .thumb_img").attr("src",f.organizerLogo)}}$("#organizerLogo").val(f.organizerLogo||static_res_prefix+"/content/bigwheel/back/files/lot/organizer_logo.jpg");$("input[name='useDefaultQrcodeBg']").eq(f.useDefaultQrcodeBg?0:1).attr("checked","checked");$("input[name='awardSendType']").eq(f.awardSendType==2?0:1).attr("checked","checked");if(f.awardSendType==1){var J=W.model.records.rankingSendRule;window.rankingSendRuleId=J.id;$(".helpType_1_cont").hide();$(".helpType_2_cont").show()}else{if(f.awardSendType==2){var C=W.model.records.challengeSendRule;console.log(C);window.challengeSendRuleId=C.id;$("#passCondition").val(C.passCondition);$("#singleDayAwards").val(C.singleDayAwards);$("#singleUserAwards").val(C.singleUserAwards);$(".helpType_1_cont").show();$(".helpType_2_cont").hide()}}$("input[name='shareType']").eq((N&(Math.pow(2,7)))==0?0:1).attr("checked","checked");$("#adv_subtab_2").attr("shareId",U.id);if((N&(Math.pow(2,7)))==0||!U){$("#set_qrcodebg_box").show();$("#wxshare_box").hide();if(f.useDefaultQrcodeBg){$(".qrcodeBgControls").hide().find("input").attr("disabled","disabled")}else{$(".qrcodeBgControls").show().find("input").removeAttr("disabled");$(".qrcodeBgControls .thumb_img").attr("src",user_img_domain+f.shareQrcodeBg)}$("#shareQrcodeBg").val(f.shareQrcodeBg)}else{$("#set_qrcodebg_box").hide();$("#wxshare_box").show();$("input[name='useShareIco']").eq(U.sttr1==0||""?0:1).attr("checked","checked");if(U.sttr1=="0"||""){$("#share_ico_controls").hide().find("input").attr("disabled","disabled")}else{$("#share_ico_controls").show().find("input").removeAttr("disabled")}if(U.imgPath){$("#share_ico_controls .thumb_img").attr("src",user_img_domain+U.imgPath)}$("#shareIco").val(U.imgPath);$("input[name='useShareTxt']").eq(U.sttr2=="0"?0:1).attr("checked","checked");$("#share_txt_controls .j-share-txt-content").eq(0).html(U.noAwardText.replace(/\${nickName}/g,'<span class="tag" contenteditable="false">玩家名称</span>').replace(/\${score}/g,'<span class="tag" contenteditable="false">游戏成绩</span>').replace(/\${rank}/g,'<span class="tag" contenteditable="false">游戏排名</span>'));$("#share_txt_controls .j-share-txt-content").eq(1).html(U.awardText.replace(/\${nickName}/g,'<span class="tag" contenteditable="false">玩家名称</span>').replace(/\${score}/g,'<span class="tag" contenteditable="false">游戏成绩</span>').replace(/\${rank}/g,'<span class="tag" contenteditable="false">游戏排名</span>').replace(/\${awardName}/g,'<span class="tag" contenteditable="false">奖项等级</span>').replace(/\${trophyName}/g,'<span class="tag" contenteditable="false">奖品名称</span>'));if(U.sttr2==1){$("#share_txt_controls").show()}$("input[name='useShareTitle']").eq(U.sttr3=="0"?0:1).attr("checked","checked");$("#share_title_controls .j-share-title-content").eq(0).html(U.titleText.replace(/\${nickName}/g,'<span class="tag" contenteditable="false">玩家名称</span>'));if(U.sttr3==1){$("#share_title_controls").show()}}$("input[name='useDefaultCopyright']").eq(f.useDefaultCopyright?0:1).attr("checked","checked");if(f.useDefaultCopyright){$(".copyrightPicControls").hide().find("input").attr("disabled","disabled")}else{$(".copyrightPicControls").show().find("input").removeAttr("disabled");$(".copyrightPicControls .thumb_img").attr("src",user_img_domain+f.customCopyrightPic)}$("#customCopyrightPic").val(f.customCopyrightPic);if(f.probabilityType==1){$("#probabilityType").attr("checked","checked")}$("input[name='hideParticipant']").eq(f.hideParticipant?1:0).attr("checked","checked");$("#participantVirtualAddCount").val(f.participantVirtualAddCount);$("input[name='trophyValidator']").eq(f.trophyValidator?0:1).attr("checked","checked");$("input[name='blacklist']").eq((N&(Math.pow(2,4)))==0?1:0).attr("checked","checked");$("input[name='securityType']").eq((N&(Math.pow(2,13)))==0?1:0).attr("checked","checked").trigger("change");$("input[name='showCopyright']").eq(f.showCopyright?1:0).attr("checked","checked");$("#globalProbability").val(f.globalProbability);$("#initialProbability").val(f.initialProbability);$("#helpProbability").val(f.helpProbability);$("#helpNum").val(f.helpNum);$("input[name='securityLevel'][value='"+f.securityLevel+"']").attr("checked","checked").trigger("change");pageTemplateId=f.pageTemplateId;window.actGamePagePath=f.path;var K=W.model.records.playRule;if(K.needArea){window.save_needArea=true;if(K.areaCode){window.save_addressList=K.areaCode}else{window.save_addressList=""}window.save_province=K.province;window.save_city=K.city}$("input[name='helpEffect']").eq((N&(Math.pow(2,5)))==0?0:1).attr("checked","checked");$("input[name='helpEffect']").trigger("change",(N&(Math.pow(2,5))));var m=W.model.records.helpRule;$("#withHelp").attr("checked",f.withHelp);if(f.withHelp){if(m){$("#percentage").val(m.percentage).attr("disabled",false);$("#helpCount").val(m.helpCount).attr("disabled",true);$("#exchangeCount").val(m.exchangeCount).attr("disabled",true);$("#minCount").val(m.minCount).attr("disabled",true);$("#maxCount").val(m.maxCount).attr("disabled",true)}$("#gamePointAddPercent").removeAttr("disabled");$(".helpType_1_cont, .helpType_2_cont").find("input").removeAttr("disabled")}else{$("#gamePointAddPercent").attr("disabled","disabled");$(".helpType_1_cont, .helpType_2_cont").find("input").attr("disabled","disabled")}var R=$.parseJSON(f.extendOperation);$("input[name='jumpLinkBtn']").eq(R.jumpLinkBtn==1?0:1).attr("checked","checked");if(R.jumpLinkBtn==1){$("#set_jumpLink2_box").hide().find("input").attr("disabled","disabled")}else{if(R.jumpLinkBtn==2){$("#set_jumpLink2_box").show().find("input").removeAttr("disabled")}}if($("input[name='bless']").length>0){$("input[name='bless']").val(R.bless)}if($("#set_seller_name_box").length>0){$("#seller_name").val(R.seller_name)}if($("textarea[name='commandWord']").length>0){$("textarea[name='commandWord']").val(R.commandWord)}if(m!=null){$("#lotteryAddCount").val(m.lotteryAddCount);if(R){$("#awardCycleTime").val(R.awardCycleTime);$("#unlockPrizeCount").val(R.unlockPrizeCount)}$("#gamePointAddPercent").val(m.gamepointAddPercent);$("#helpType").val(m.helpType)}if(R&&R.loadingLink){$("#openingLink").val(R.loadingLink)}if(R&&R.copyrightLink){$("#copyrightLink").val(R.copyrightLink)}if(R&&R.isOpenClick){$("input[name='isOpenClick']").eq(R.isOpenClick?1:0).attr("checked","checked")}if(R&&R.isOpenClick){$(".openClickControls").show().find("input").removeAttr("disabled");if(R.openClickPic.indexOf("http")==-1){$(".openClickControls .thumb_img").attr("src",user_img_domain+R.openClickPic)}else{$(".openClickControls .thumb_img").attr("src",R.openClickPic)}}else{$(".openClickControls").hide().find("input").attr("disabled","disabled")}$("#openClickPic").val(R.openClickPic||static_res_prefix+"/content/bigwheel/back/files/lot/open_click_btn.png");if(R&&R.collect){$("#collect").val(R.collect)}if(R&&R.initialProbability){$("#initialProbability").val(R.initialProbability)}if(R&&R.helpNum){$("#helpNum").val(R.helpNum)}if(R&&R.slogan){if(_isJiWuFu&&R.slogan!=""){var H=$("#form_jiwufu_gametext_setting");$("input[name='jiwufu_slogan_radio']",H).eq(1).attr("checked","checked");$("input[name='jiwufu_slogan_radio']",H).trigger("change");try{var w=R.slogan.split("::");$("#cus_jiwufu_text_cont input").each(function(e,i){var X=$(i);X.val(w[e])})}catch(V){}}if(templateId==14){var H=$("#form_jiwufu_gametext_setting");$("input[name='jiwufu_slogan_radio']",H).eq(1).attr("checked","checked");$("input[name='jiwufu_slogan_radio']",H).trigger("change");try{var w=R.slogan.split("::");$("#cus_jiwufu_text_cont input").each(function(e,i){var X=$(i);X.val(w[e])})}catch(V){}}}if(_isNewBargain){$("input[name='totalLength']").val(R.totalLength);$("input[name='elongationMin']").val(R.elongationMin);$("input[name='elongationMax']").val(R.elongationMax);$("input[name='shortenMin']").val(R.shortenMin);$("input[name='shortenMax']").val(R.shortenMax)}if(_isZcqc){$("#startTime").val(R.startTime);$("#endTime").val(R.endTime)}if(_isValuationHunter){if(R.hunter){var z=R.hunter;var T=$("#valuationHunter_goodsImg_modal").find(".hunter_ul").find("li");for(var S=0;S<z.size;S++){var v=z[(S+1)+"_size"].match(/\d+/g);setTimeout(function(){$$(".vh_good").attr("src",z["1_path"]);$$(".vh_tip2_1").text("以上物品价格为"+z["1_size"].match(/\d+/g)[0]+"~"+z["1_size"].match(/\d+/g)[1]+"元")},1200);T.eq(S).find(".fileupload_input").val(z[(S+1)+"_path"]);T.eq(S).find(".hunter_img").attr("src",z[(S+1)+"_path"]);T.eq(S).find(".hunter_minNum").val(v[0]);T.eq(S).find(".hunter_maxNum").val(v[1]);T.eq(S).removeClass("hunter_li_hide");$(function(){$(".hunter_add_btn").hide();$(".hunter_delete_btn").hide();var i=$("#valuationHunter_goodsImg_modal").find("li").length-1;var e=$(".hunter_li_hide").length;$("#valuationHunter_goodsImg_modal").find("li").eq(i-e-1).find(".hunter_delete_btn").show();if((i-e)<5){$("#valuationHunter_goodsImg_modal").find("li").eq(i-e-1).find(".hunter_add_btn").show()}});if(_hasPublish){$(".hunter_minNum").attr("disabled","disabled");$(".hunter_maxNum").attr("disabled","disabled");$(".hunter_add_btn").hide();$(".hunter_delete_btn").hide()}}}}$("#dayCount").val(K.dayCount);$("#dayIncrCount").val(K.dayIncrCount);$("#initCount").val(K.initCount);$("#playCount").val(K.playCount);$("#totalLotteryCount").val(K.totalLotteryCount);$("input[name='totalLotteryCountRadio']").eq(K.limitLottery?1:0).attr("checked","checked");if(K.limitLottery){$("#totalLotteryCount").removeAttr("disabled")}$("#dayLotteryCount").val(K.dayLotteryCount);$("input[name='gameTimeRadio']").eq(1).attr("checked","checked");$("input[name='forceAttent']").eq(K.needFollow?0:1).attr("checked","checked");$("#gameTime").val(K.gameTime);$("input[name='participateLimit']").eq(K.participateLimit?0:1).attr("checked","checked");$("input[name='exchangeLimit']").eq(K.exchangeLimit?0:1).attr("checked","checked").trigger("change");if((N&(Math.pow(2,2)))!=0){$("input[name='exchangeLimitDetail'][value='4']").attr("checked","checked")}if((N&(Math.pow(2,1)))!=0){$("input[name='exchangeLimitDetail'][value='2']").attr("checked","checked")}if((N&(Math.pow(2,14)))!=0){if(R.checkAwardExtend){var L=R.checkAwardExtend.split(",");var u="";if(L.length>=2){$("#set_exchangeLimitDetail_box .add-undefind-box").addClass("hide")}for(var S=0;S<L.length;S++){u+='<div class="exchange-content"><label class="checkbox inline"><span class="exchangeName">'+L[S]+'</span></label><span class="close-btn">&times;</span></div>'}$("#set_exchangeLimitDetail_box .exchangeLimitDetail-content").append(u)}}var o=W.model.records.awardBindPrizes;$("#awardCount").attr("disabled",true);$("#awardCount").val(o.length);var x=0;var r={items:[]};for(var S=0;S<o.length;S++){var n=getTrophyName(1,S);if(o[S].award.operationTip==""){o[S].award.operationTip="凭券联系现场工作人员兑奖"}if(o[S].award.storeAddress==""){o[S].award.storeAddress="请填写您的兑奖地址或者门店地址"}r.items.push({hidden:o[S].award.deleted,index:S+1,awardId:o[S].award.id,trophyId:o[S].trophy.id,trophyName:o[S].trophy.trophyName,operationTip:o[S].award.operationTip,storeAddress:o[S].award.storeAddress,description:o[S].award.description,subhead:o[S].award.subhead,serviceTel:o[S].award.serviceTel,integralConvert:o[S].award.integralConvert,});if(!o[S].award.deleted){if(o[S].trophy.awardType==2){x+=o[S].trophy.awardRealNum}}}$("#smsfreeze_total").text(x);hasPublish=f.statu!=0&&!isReCreate;load_award_tab(r);for(var S=0;S<o.length;S++){var G=$(".award_tab_"+S);var P=o[S].award;var t=$.parseJSON(P.custom);G.find("select[name='awardLevel']").val(P.awardLevel);G.find("input[name='awardName']").val(P.awardName);if((N&(Math.pow(2,10)))==0){G.find("input[name='probabilityValue']").val(10)}else{G.find("input[name='probabilityValue']").val(P.probabilityValue)}var b=o[S].trophy;var F=o[S].extendData;G.find("select[name='awardType']").val(b.awardType);G.find("input[name='trophyName']").val(b.trophyName);G.find("input[name='awardRealNum']").val(b.awardRealNum);G.find("input[name='awardVirtualNum']").val(b.awardVirtualNum);G.find("input[name='totalCount']").val(b.totalCount/100).trigger("keyup");G.find("input[name='singleMin']").val(b.singleMin/100);G.find("input[name='singleMax']").val(b.singleMax/100);G.find("input[name='validityStart']").val(new Date(b.validityStart).Format("yyyy-MM-dd HH:mm:ss"));G.find("input[name='validityStop']").val(new Date(b.validityStop).Format("yyyy-MM-dd HH:mm:ss"));G.find("select[name='awardType']").trigger("change",true);G.find("input[name='isWxCard']").eq(b.isWxCard?0:1).attr("checked","checked");if((P.logicSwitch&(Math.pow(2,0)))==0){G.find("input[name='defaultWinner']").eq(0).attr("checked","checked").trigger("change")}else{G.find("input[name='defaultWinner']").eq(1).attr("checked","checked").trigger("change");G.find("input[name='defaultWinnerAmount']").val(t.setSwitchNum)}if(t&&t.guanwanJumpBtn){if(t.guanwanJumpBtn=="true"){G.find("input[name='guanwanJumpBtn']").eq(1).attr("checked","checked").trigger("change");G.find(".jumpBtnNameBox").show().find("input[name='jumpBtnName']").val(t.jumpBtnName);G.find(".jumpLinkBox").show().find("input[name='jumpLink']").val(t.jumpLink);$$("#jumpBtn").find(".text").text(t.jumpBtnName)}}initFileUpload(G.find("input[name='fileupload']"),function(Z,Y){for(var e=0;e<$(".award_tab").length;e++){if(!$(".award_tab").eq(e).is(":hidden")){var X=$(".award_tab").eq(e).attr("data-id");break}}console.log(X);$$("#prizeList").find("li").eq(X).find(".prize_img").attr("src",Z._response.result.fileUrl);G.find("input[name='prize_image']").val(Z._response.result.fileUrl);G.find(".prize_thumb_img").attr("src",Z._response.result.fileUrl)});if(hasPublish){if(b.awardType==2){G.find("input[name='awardRealNum']").closest(".redpack_award_type").children(".control-label").text("红包剩余：");G.find("input[name='awardRealNum']").attr("disabled",true);G.find(".trophy_redpack_text").show();G.find(".trophy_datetime").hide().find("input").attr("disabled","disabled");G.find(".j-sncode-type").hide().find("textarea").attr("disabled","disabled");G.find(".add_redpack_award").removeClass("hide")}else{G.find(".add_sncode_award").removeClass("hide");G.find("input[name='awardRealNum']").attr("disabled","disabled")}G.find("input[name='awardRealNum']").val(F.dataMap.enableNum);G.find("input[name='awardLoseNum']").val(Number(b.awardRealNum)-Number(F.dataMap.enableNum));G.find(".awardLoseBox").show();G.find(".defaultWinnerLoseBox").show();var p=F.dataMap.switchInitNum||0;var A=F.dataMap.switchUsedNum||0;if((P.logicSwitch&(Math.pow(2,0)))!=0){}G.find("input[name='defaultWinnerAmount']").attr("disabled","disabled").val(p-A);G.find("input[name='defaultWinnerLoseNum']").val(A);G.find("input[name='awardDefaultWinnerNum']").val(p);G.find(".defaultWinnerAmount-tips").hide();G.find(".add_defaultwinner_award").show();G.find("input[name='validityStart']").attr("disabled",true);G.find("input[name='validityStop']").attr("disabled",true);G.find("input[name='trophyName']").attr("disabled",true);G.find("input[name='totalCount']").attr("disabled",true);G.find("input[name='singleMin']").attr("disabled",true);G.find("input[name='singleMax']").attr("disabled",true)}var j=Number(b.awardType);var Q=b.deleted;if(j!=2&&!Q){var M=Number($("input[name='trophyId']").eq(S).val());var B=Number(b.snGenerateType);var d=G.find("input[name='sncodeType']");var D=d.closest(".controls").siblings(".j-sncode-controls");if(B===3){d.eq(0).attr("checked","false");d.eq(1).attr("checked","checked");D.show();D.children("textarea").removeAttr("disabled");bindSncodeCheck();var g=W.model.records._userImportSnMap;var O=g[M]["0"];var s=g[M]["1"];D.children("textarea").html(O.toString().replace(/,/g,"\n"));D.children("textarea").attr("usedSncodes",s)}}if(_isNewBargain&&S==0){if(t!=null){G.find("input[name='detailLink']").val(t.detailLink)}G.find("input[name='virtualNum']").val(R.virtualNum)}if(R&&R.withdrawThresholdMax&&R.withdrawThresholdMin){if(_isYyttl){$("#award_detail_form_0 .withdrawThreshold_Max").val(R.withdrawThresholdMax/100);if(R.withdrawThresholdMin===100){$("#award_detail_form_0 input[name='withdrawThresholdRadio']").eq(0).attr("checked","checked")}else{if(R.withdrawThresholdMin===300){$("#award_detail_form_0 input[name='withdrawThresholdRadio']").eq(1).attr("checked","checked")}else{$("#award_detail_form_0 input[name='withdrawThresholdRadio']").eq(2).trigger("click");$("#award_detail_form_0 input[name='withdrawThresholdMin']").val(R.withdrawThresholdMin/100)}}}}}if(R&&R.loadingPic){var h=R.loadingPic;var E=h.replace(/(^url\(")/,"").replace(/"\)$/,"");$(".loadPagePicControls").eq(0).find(".thumb_img").attr("src",E);$(".loadPagePicControls").eq(0).find(".fileupload_input").val(E);var l=$(".loadPagePicControls").eq(0).find("input[name='fileupload']").attr("data-defaulturl");if(l!=E){$("input[name='useDefaultLoadPage']").eq(1).attr("checked","checked").trigger("change");$(".loadPagePicControls").eq(0).find(".huifuBtn").show()}}if(R&&R.loadingLogo){var c=R.loadingLogo;var y=c.replace(/(^url\(")/,"").replace(/"\)$/,"");$(".loadPagePicControls").eq(1).find(".thumb_img").attr("src",y);$(".loadPagePicControls").eq(1).find(".fileupload_input").val(y);var l=$(".loadPagePicControls").eq(1).find("input[name='fileupload']").attr("data-defaulturl");if(l!=y){$("input[name='useDefaultLoadPage']").eq(1).attr("checked","checked").trigger("change");$(".loadPagePicControls").eq(1).find(".huifuBtn").show()}}$("#wxname").val(f.wxname);$("#wxlink").val(f.wxlink);$("input[name='open_opening_link']").eq((N&(Math.pow(2,3)))==0?0:1).attr("checked","checked");if($("input[name='open_opening_link']:checked").val()==0){$("#opening_link, #set_openClick_box").hide();$(".openClickControls").hide().find("input").attr("disabled","disabled")}else{$("#opening_link, #set_openClick_box").show()}$("input[name='validityStart']").datetimepicker();var I=new Date().getTime($("#validityStart").val());$("input[name='validityStop']").datetimepicker({minDate:new Date(I)});$("input[name='probabilityMode']").eq((N&(Math.pow(2,10)))==0?0:1).attr("checked","checked");if(hasPublish){$("input[data-editable='false']").attr("disabled","disabled");$("select[data-editable='false']").attr("disabled","disabled");$(".del_award_tab_item,.add_award_tab_item").hide()}}else{alert(W.msg)}var q=setInterval(function(){if(previewWinHasLoad){try{$("#ruleTips").trigger("keyup");$("#globalProbability").trigger("keyup");$("#initialProbability").trigger("keyup");$("#helpProbability").trigger("keyup");$("#helpNum").trigger("keyup");$("#organizer").trigger("keyup");$("#startDate").trigger("change");$("#passCondition").trigger("keyup");$("input[name='awardName']").eq(0).trigger("keyup");$("input[name='awardSendType']").trigger("change");$("input[name='probabilityMode']").trigger("change");$("input[name='showDanmu']").trigger("change");if(f.showCopyright){$$("#start_bottom").show()}else{$$("#start_bottom").hide()}if(f.hideParticipant){$$("#join_line_cont").hide()}else{$$("#join_line_cont").show()}if(!f.useDefaultCopyright){$$("#startLogoImg").attr("src",user_img_domain+f.customCopyrightPic)}if(!f.useDefaultQrcodeBg){$$("#help_qrcode_img").attr("src",user_img_domain+f.shareQrcodeBg)}if(!f.hideOrganizerLogo){$$(".organizer-btn").show()}if(R&&R.isOpenClick){$$(".openClick-btn").show()}if($("#set_bless_box").length>0){$("#bless").trigger("keyup")}if($("#set_seller_name_box").length>0){$("#seller_name").trigger("keyup")}triggerAwardDetailPhoneTxt(true);var ad=$('<div data-index="0" class="myprize_item s0"><p class="award_name">'+$("input[name='awardName']").eq(0).val()+'</p><p class="expired_time">'+$("input[name='trophyName']").eq(0).val()+'</p><p class="exchange_statu">未领取<p></div>');$$(".fire_rule .myprize_list_cont").prepend(ad);if(_isNewShakeRedpack){if(R&&R.redpackText){var Z=$$(".redpack_text p");var ac=R.redpackText.split("::");for(var Y=0;Y<ac.length;Y++){var af=ac[Y];$("#newshakeredpack_redpacktext_"+(Y+1)).val(af);Z.eq(Y).text(af)}}}if(_isNewPzhb){R&&R.newPzhb1&&$("#newPzhb1").val(R.newPzhb1);R&&R.newPzhb2&&$("#newPzhb2").val(R.newPzhb2);R&&R.newPzhb3&&$("#newPzhb3").val(R.newPzhb3)}$("#set_globalAwardVirtualNum_box #globalAwardVirtualNum").val(R.globalAwardVirtualNum||0);afterPreviewWinLoad(W);if($("input[name='helpEffect']:checked").val()==="32"){if(N&Math.pow(2,(1-1))===1){$("#helpAward").hide();$("#helpAward2").show();$("#helpEffectMs1").trigger("click")}else{$("#helpAward").show();$("#helpAward2").hide();$("#helpEffectMs2").trigger("click")}}if(R&&R.awardCycleTime){$("#awardCycleTime2").val(R.awardCycleTime)}if(R&&R.unlockPrizeCount){$("#unlockPrizeCount2").val(R.unlockPrizeCount)}if(_isPanoredpack){$("#lotteryCount").remove();if(hasPublish){$(".helpType_1_cont").find("input").attr("disabled","disabled")}}if(_isBigWheel||_isAbsolutelyBigWheel){var X=JSON.parse(f.awardTips);if(X.length>0&&X.length<3){$$("#wheelBox").removeClass().addClass("prizeList4");$$("#prizeList").find("li").removeClass().addClass("prize4")}else{if(X.length>2&&X.length<5){$$("#wheelBox").removeClass().addClass("prizeList6");$$("#prizeList").find("li").removeClass().addClass("prize6")}else{if(X.length>4&&X.length<7){$$("#wheelBox").removeClass();$$("#prizeList").find("li").removeClass().addClass("prize")}else{if(X.length>6&&X.length<9){$$("#wheelBox").removeClass().addClass("prizeList10");$$("#prizeList").find("li").removeClass().addClass("prize10")}}}}setTimeout(function(){for(ai in X){$$("#prizeList").find("li").eq(ai).find(".prize_name").text(X[ai].trophyName);$$("#prizeList").find("li").eq(ai).find(".prize_img").attr("src",static_res_prefix+"/content/bigwheel/back/files/lot/p3.png")}},0)}var X=JSON.parse(f.awardTips);console.log(o);for(var Y=0;Y<o.length;Y++){if(Y>X.length-1){break}var ae=$(".award_tab_"+Y);var ab=o[Y].award;if(ab.awardPic){console.log(ab.awardPic);console.log(ae.find("input[name='prize_image']"));ae.find("input[name='prize_image']").val(ab.awardPic);ae.find(".prize_thumb_img").attr("src",user_img_domain+ab.awardPic);$$("#prizeList").find("li").eq(Y).find(".prize_img").attr("src",user_img_domain+ab.awardPic)}}window.clearInterval(q)}catch(aa){window.clearInterval(q)}}},200);initBecomeGrey()},error:function(b,d,c){alert("服务器正在紧张的运行中，请稍后再试")}})};var lipin_award=["价值100元礼品券","价值50元礼品券","价值10元礼品券","价值5元礼品券","价值2元礼品券","价值1元礼品券","价值1元礼品券","价值1元礼品券"];var youhui_award=["100元优惠券","50元优惠券","10元优惠券","5元优惠券","2元优惠券","1元优惠券","1元优惠券","1元优惠券"];var dikou_award=["100元抵扣券","50元抵扣券","10元抵扣券","5元抵扣券","2元抵扣券","1元抵扣券","1元抵扣券","1元抵扣券"];var hongbao_award=["100元现金红包","50元现金红包","10元现金红包","5元现金红包","2元现金红包","1元现金红包","1元现金红包","1元现金红包"];var getTrophyName=function(b,a){if(b==1||b=="1"){return lipin_award[a]}else{if(b==2||b=="2"){return hongbao_award[a]}else{if(b==4||b=="4"){return youhui_award[a]}else{if(b==5||b=="5"){return dikou_award[a]}}}}};var load_award_tab=function(g){var f=document.getElementById("award_tab_item_tpl").text;var a=document.getElementById("award_tab_content_tpl").text;var j=$.template(f).render(g);var b=$.template(a).render(g);$(".award_tab_item").html(j);$(".award_tab_content").html(b);$(".award_tab_item_link").off("click").on("click",function(){$(".award_tab_item>li").removeClass("active");$(this).closest("li").addClass("active");$(".award_tab").hide();$(".award_tab_"+$(this).data("idx")).show();triggerAwardDetailPhoneTxt()});var i=1;var d=200;if(_isZcqc){i=0.1;d=5}$(".award_tab_content .award_tab").each(function(k,l){$(l).find("form").validate({onfocusout:false,rules:{awardName:{required:true,maxlength:16},trophyName:{required:true,maxlength:16},awardRealNum:{required:true,awardNum:true},defaultWinnerAmount:{required:true,defaultWinnerAmount:true},probabilityValue:{required:true,digits:true,probabilityValueTotal:true},totalCount:{required:true,number:true,min:1,max:400000,validateTotalMoney:true},singleMin:{required:true,number:true,min:i,max:d},singleMax:{required:true,number:true,min:i,max:d,singleMax:true},validityStart:{required:true},operationTip:{required:true},sncodes:{required:!hasPublish,snCode:true},validityStop:{required:true,validityStop:true},detailLink:{url:true},virtualNum:{required:true,digits:true,min:0,max:400000},totalLength:{required:true,digits:true,min:1,max:300},withdrawThresholdMin:{required:true,number:true,min:1,max:200,withdrawThresholdMin:true},withdrawThresholdMax:{required:true,number:true,min:1,max:200,withdrawThresholdMax:true},jumpBtnName:{required:true,maxlength:16},jumpLink:{required:true,url:true}},messages:{awardName:{required:"不能为空",maxlength:"不能超过16个字符"},trophyName:{required:"不能为空",maxlength:"不能超过16个字符"},awardRealNum:{required:"不能为空",awardNum:"奖品总数量在1-10000之间"},defaultWinnerAmount:{required:"不能为空",defaultWinnerAmount:"内定奖品数量必须大于0且不能大于奖品数量"},probabilityValue:{required:"不能为空",digits:"必需为数值",probabilityValueTotal:"所有奖项中奖概率之和不能大于100%"},totalCount:{required:"不能为空",number:"必需为数值",min:"数值至少为1",max:"数值最大为400000"},singleMin:{required:"不能为空",number:"必需为数值",min:"数值至少为1",max:"数值最大为200"},singleMax:{required:"不能为空",number:"必需为数值",min:"数值至少为1",max:"数值最大为200"},validityStart:{required:"不能为空"},operationTip:{required:"不能为空"},sncodes:{required:"不能为空",snCode:"券号格式错误"},validityStop:{required:"不能为空"},virtualNum:{required:"不能为空",digits:"必需为数值",min:"数值至少为0",max:"数值最大为400000"},totalLength:{required:"不能为空",digits:"必需为数值",min:"数值至少为1",max:"数值最大为300"},withdrawThresholdMin:{required:"不能为空",number:"必需为数值",min:"数值至少为1",max:"数值最大为200"},withdrawThresholdMax:{required:"不能为空",number:"必需为数值",min:"数值至少为1",max:"数值最大为200"},jumpBtnName:{required:"不能为空",maxlength:"不能超过16个字符"},jumpLink:{required:"不能为空",url:"格式错误"}},showErrors:function(m,o){if(o&&o.length>0){$.each(o,function(p,r){var q=$(r.element);if(q.is(".cover")){alert(r.message)}q.closest(".control-group").addClass("error");q.attr("title",r.message)})}else{var n=$(this.currentElements);n.closest(".control-group").removeClass("error");n.removeAttr("title")}},submitHandler:function(){return false}})});$.validator.addMethod("withdrawThresholdMin",function(r,o,m){if(_isYyttl){var s=Number($('input[name="totalCount"]').val());var n=Number(r);var p;var q=Number($(".withdrawThreshold_Max").val());var k=$("input[name='withdrawThresholdRadio']:checked").val();if(k==1){p=1}else{if(k==3){p=3}else{if(k==4){p=Number($(".withdrawThreshold_Min").val())}}}var l=Math.floor(s/((+p+q)/2));if(p<=q&&p<=200&&p>=1&&l>0){return true}else{return false}}},"1.提现最高金额门槛要大于提现最低金额门槛2.红包总金额至少可供1个用户参与游戏3.红包最高金额限制为200元以内");$.validator.addMethod("withdrawThresholdMax",function(r,o,m){if(_isYyttl){var s=Number($('input[name="totalCount"]').val());var q=Number(r);var n=Number($(".withdrawThreshold_Min").val());var p;var k=$("input[name='withdrawThresholdRadio']:checked").val();if(k==1){p=1}else{if(k==3){p=3}else{if(k==4){p=Number($(".withdrawThreshold_Min").val())}}}var l=Math.floor(s/((+p+q)/2));if(q>=p&&q>=1&&q<=200&&l>0){return true}else{return false}}},"1.提现最高金额门槛要大于提现最低金额门槛2.红包总金额至少可供1个用户参与游戏3.红包最高金额限制为200元以内");if($("#award_convert_limit_form").length>0){var e=document.getElementById("award_convert_limit_tpl").text;var c=$.template(e).render(g);$("#award_convert_limit").html(c);var h=$("#award_convert_limit_form").validate({onfocusout:false,rules:{integralConvert0:{required:true,digits:true,min:1,max:999},integralConvert1:{required:true,digits:true,min:1,max:999},integralConvert2:{required:true,digits:true,min:1,max:999},integralConvert3:{required:true,digits:true,min:1,max:999},integralConvert4:{required:true,digits:true,min:1,max:999},integralConvert5:{required:true,digits:true,min:1,max:999},integralConvert6:{required:true,digits:true,min:1,max:999},integralConvert7:{required:true,digits:true,min:1,max:999},percentage:{required:true,digits:true,min:1,max:100}},messages:{integralConvert0:{required:"不能为空",digits:"必需为数值",min:"数值至少为1",max:"数值最大为999"},integralConvert1:{required:"不能为空",digits:"必需为数值",min:"数值至少为1",max:"数值最大为999"},integralConvert2:{required:"不能为空",digits:"必需为数值",min:"数值至少为1",max:"数值最大为999"},integralConvert3:{required:"不能为空",digits:"必需为数值",min:"数值至少为1",max:"数值最大为999"},integralConvert4:{required:"不能为空",digits:"必需为数值",min:"数值至少为1",max:"数值最大为999"},integralConvert5:{required:"不能为空",digits:"必需为数值",min:"数值至少为1",max:"数值最大为999"},integralConvert6:{required:"不能为空",digits:"必需为数值",min:"数值至少为1",max:"数值最大为999"},integralConvert7:{required:"不能为空",digits:"必需为数值",min:"数值至少为1",max:"数值最大为999"},percentage:{required:"不能为空",digits:"必需为数值",min:"数值至少为1",max:"数值最大为100"}},showErrors:function(k,m){if(m&&m.length>0){$.each(m,function(n,p){var o=$(p.element);if(o.is(".cover")){alert(p.message)}o.closest(".control-group").addClass("error");o.attr("title",p.message)})}else{var l=$(this.currentElements);l.closest(".control-group").removeClass("error");l.removeAttr("title")}},submitHandler:function(){return false}})}};function sncodeCheck(p){if(p.hasClass("disabled")){return false}p.addClass("disabled").text("检测中...");var m=p.closest(".control-group").children(".j-sncode-controls");var a=m.children("textarea");var b=p.closest("#add_sncode_award_modal");if(b.size()>0){var c=Number(b.find("input[name='award_unsend_num']").val())}else{var c=Number(m.closest(".control-group").siblings(".redpack_award_type").find("input[name='awardRealNum']").val())}var n=a.val().split(/\n/g);var o=n.length;if(hasPublish&&c===0){if(a.val()&&o!==c){m.find(".j-sncode-msg").text("当前券号数量为"+n.length+"个，与奖品数量"+c+"不一致");p.removeClass("disabled").text("检测格式");return false}m.find(".j-sncode-msg").text("检测通过！");p.removeClass("disabled").text("检测格式");return true}else{if(o!==c){m.find(".j-sncode-msg").text("当前券号数量为"+n.length+"个，与奖品数量"+c+"不一致");p.removeClass("disabled").text("检测格式");return false}if(!a.val()){m.find(".j-sncode-msg").text("券号不能为空！");p.removeClass("disabled").text("检测格式");return false}for(var k=0;k<o;k++){n[k]=n[k].replace(/\s/g,"");if(!(/^[0-9a-zA-Z]{1,20}$/g).test(n[k])||n[k]==0){m.find(".j-sncode-msg").html("格式错误，券号格式为20以内的数字和字母！<br/ >错误券号为："+n[k]);p.removeClass("disabled").text("检测格式");return false}}var h=[];var l=a.attr("usedsncodes");if(l){var f=n.concat(l.split(","))}else{var f=n}for(var k=0;k<f.length;k++){var e=f[k];for(var g=0;g<f.length;g++){var d=f[g];if(k!=g&&d==e){if(h.indexOf(e)==-1){h.push(e)}}}}if(h.length>0){m.find(".j-sncode-msg").text("券号重复，重复券号为："+h.join("、"));p.removeClass("disabled").text("检测格式");return false}else{m.find(".j-sncode-msg").text("检测通过！");p.removeClass("disabled").text("检测格式");return true}}}function bindSncodeCheck(){$(".award_tab form").each(function(){var a=$(this);a.find(".j-check-sncode").on("click",function(){sncodeCheck($(this))})})}function insertShareTxt(){var a=$("body");a.on("click",".j-insert-tag",function(){var d=$(this).text();var f=$(this).closest(".j-share-txt-box").children(".j-share-txt-content");var g=$(this).text();var c=$('<span class="tag" contenteditable="false">'+d+"</span>");var e=window.getSelection();var b=f.data("range");if(!b){f.append(c)}else{e.removeAllRanges();e.addRange(b);b.deleteContents();b.insertNode(c[0]);b=b.cloneRange();b.setStartAfter(c[0]);b.collapse(true);e.removeAllRanges();e.addRange(b);f.data("range",b)}f.find("br").remove();f.append("<br>")})}$("body").on("click",".j-share-txt-content",function(b){if($(b.target).hasClass("tag")){return}var a=window.getSelection();$(this).data("range",a.getRangeAt(0).cloneRange())}).on("keyup paste",".j-share-txt-content",function(){var a=window.getSelection();$(this).data("range",a.getRangeAt(0).cloneRange())}).on("blur",".j-share-txt-content",function(){checkShareContet(this)}).on("focus",".j-share-txt-content",function(){$(this).removeClass("error");$(this).siblings(".j-share-msg").hide()});function checkShareContet(c){var h=$(c).html().replace(/[ ]/g,"").replace("<br>","");if(!h){$(c).addClass("error");$(c).siblings(".j-share-msg").text("自定义分享内容不能为空！").show();$("input[name='checkShareTxt']").val(0);return false}var g=["红包"];var e=[];var a="";for(var f=0;f<g.length;f++){var b=g[f];if(h.indexOf(b)!=-1){e.push("“"+b+"”")}}for(var d=0;d<e.length;d++){a+=e[d];if(d<e.length-1){a+="、"}}if(e.length>0){$(c).addClass("error");$(c).siblings(".j-share-msg").text("分享内容存在微信敏感词"+a+"，请先修改。").show();$("input[name='checkShareTxt']").val(0);return false}else{$("input[name='checkShareTxt']").val(1);return true}}function awardNumCheck(d,a){var g=0;var f=0;var c=10000;var b=10000;if(_packageType==5){b=10000}else{if(_packageType==2){b=50000}else{if(_packageType==3){b=100000}else{if(_packageType==4){b=300000;c=50000}else{if(_packageType==10){b=500000;c=100000}}}}}var h=d||"";var e=h.closest(".award_tab").find("select[name='awardType']").val()==2;if(Number(d.val())+Number(d.parent().find("input[name='awardLoseNum']").val())<0){return false}$(".prize_tab_item:not('.hide')").each(function(){var j=$(this).children("a").attr("data-idx");var k=Number($(".award_tab_"+j).find("input[name='awardRealNum']").val());var i=Number($(".award_tab_"+j).find("input[name='awardLoseNum']").val());if($(".award_tab_"+j).find("select[name='awardType']").val()==2){f=f+k+i}else{if(d.is("#add_sncode_award_num")&&$(".award_tab_"+j).attr("data-awardid")==$("#add_sncode_award_modal").attr("data-awardid")){}else{g=g+k+i}}});if($("input[name='vehicle']").is(":checked")){var a=1000000}else{var a=10000}if(d.is("#add_redpack_num")){f+=Number(d.val());e=true}if(d.is("#add_sncode_award_num")){g+=Number(d.val());e=false}if(!e&&(g>c||g==0)){h.closest(".control-group").addClass("error");h.siblings(".j-awardNum-tips").html('<span class="help-inline">活动的奖券类奖品总数必须大于0且不能超过'+toThousands(c)+"</span>").show();return false}else{if(e&&(f>b||f==0)){h.closest(".control-group").addClass("error");h.siblings(".j-awardNum-tips").html('<span class="help-inline">活动的红包类奖品总数必须大于0且不能超过'+toThousands(b)+"</span>").show();return false}else{h.closest(".control-group").removeClass("error");h.siblings(".j-awardNum-tips").hide();return true}}}function triggerAwardDetailPhoneTxt(a){if(a){$(".award_tab_content .award_tab").eq(0).find("input[name='trophyName'], input[name='subhead'], input[name='operationTip'], input[name='storeAddress'], input[name='serviceTel'], textarea[name='description']").trigger("keyup");$(".award_tab_content .award_tab").eq(0).find("input[name='validityStart'], input[name='validityStop']").trigger("change")}else{$("input[name='trophyName']:visible, input[name='subhead']:visible, input[name='operationTip']:visible, input[name='storeAddress']:visible, input[name='serviceTel']:visible, textarea[name='description']:visible").trigger("keyup");$("input[name='validityStart']:visible, input[name='validityStop']:visible").trigger("change")}$("input[name='jumpBtnName']:visible").trigger("keyup");if($("input[name='guanwanJumpBtn']:visible:checked").val()==1){$$("#jumpBtn").hide()}else{if($("input[name='guanwanJumpBtn']:visible:checked").val()==2){$$("#jumpBtn").show().find(".text").text($("input[name='jumpBtnName']:visible").val())}}}var initActivity=function(){initCitySelector();$("#startDate").datetimepicker();var a=new Date().getTime($("#startDate").val());var b=new Date().getTime()+90*24*60*60*1000;$("#endDate").datetimepicker({minDate:new Date(a),maxDate:new Date(b)});$(document).on("input",".onlyNum",function(){$(this).val($(this).val().replace(/[^0-9\.]/g,""))});$(document).on("input",".onlyIntNum",function(){$(this).val($(this).val().replace(/[^0-9]/g,""))});$(document).on("input",".onlyNumWithFixed",function(){var h=$(this).attr("fixed")||2;var f=$(this).val().replace(/[^0-9\.]/g,"");var e=f.indexOf(".");if(e>=0&&f.length-e-1>h){f=f.substr(0,e+3)}var j=0;for(var g=0;g<f.length;g++){if(f[g]=="."){j++}}if(j>1){f="0"}$(this).val(f)});$(".award_tab_content").on("input","input[name='awardRealNum']",function(){awardNumCheck($(this),10000)});$("#add_redpack_modal").on("input","input[name='add_redpack_num']",function(){awardNumCheck($(this),10000)});$("#add_sncode_award_modal").on("input","input[name='award_unsend_num']",function(){awardNumCheck($(this),10000)});$(".add_award_tab_item").live("click",function(){var e=$(".award_tab_item li.hide").eq(0);e.removeClass("hide");if($(".award_tab_item li.hide").size()==0){$(this).hide()}$(".del_award_tab_item").show();$("input[name='awardName']").eq(0).trigger("keyup");if($("#award_convert_limit_form").length>0){var f=e.index();var g=$("#award_convert_limit").find(".convert_limit").eq(f);g.show().removeClass("hide");g.find("input").removeAttr("disabled")}});$(".del_award_tab_item").live("click",function(){if($(".award_tab_item li.prize_tab_item:visible").size()<=1){$(this).hide();return false}var e=$(".award_tab_item li.prize_tab_item:visible:last");if(e.hasClass("active")){e.prev().find(".award_tab_item_link").click()}e.addClass("hide");if($(".award_tab_item li.prize_tab_item:visible").size()<=1){$(this).hide()}$(".add_award_tab_item").show();$("input[name='awardName']").eq(0).trigger("keyup");triggerAwardDetailPhoneTxt();if($("#award_convert_limit_form").length>0){var f=e.index();var g=$("#award_convert_limit").find(".convert_limit").eq(f);g.hide().addClass("hide");g.find("input").attr("disabled","disabled")}});$(".award_tab_content").on("change","select[name='awardType']",function(h,i){var f=$(this).val();var g=$(this).closest(".award_tab");if(f==2){g.find(".trophy_redpack_text").show().find("input").removeAttr("disabled");g.find(".trophy_datetime").hide().find("input").attr("disabled","disabled");g.find(".set_isWxCard_box").hide();g.find(".awardSettingLine").hide();g.find(".awardDetailSetting").hide();g.find(".redpack_award_type .control-label").text("红包数量");g.find(".j-sncode-type").hide().find("textarea").attr("disabled","disabled")}else{g.find(".trophy_redpack_text").hide().find("input").attr("disabled","disabled");g.find(".trophy_datetime").show().find("input").removeAttr("disabled");g.find(".set_isWxCard_box").show();g.find(".awardSettingLine").show();g.find(".awardDetailSetting").show();g.find(".redpack_award_type .control-label").text("奖品数量：");g.find(".j-sncode-type").show();if(g.find("input[name='sncodeType']:checked").val()!=1){$("input[name='sncodeType']").trigger("change")}}if(!i){var e=g.find("select[name='awardLevel']").data("value");g.find("input[name='trophyName']").val(getTrophyName(f,e-1))}$("input[name='trophyName']:visible").trigger("keyup")});$(".award_tab_content").on("change",".award_tab:visible form input[name='sncodeType']",function(){var e=$(this).val();var f=$(this).closest(".control-group").children(".j-sncode-controls");if(e==1){f.hide();f.children("textarea").attr("disabled","disabled")}else{f.show();f.children("textarea").removeAttr("disabled");bindSncodeCheck()}});$(".awardSettingLine").live("click",function(){$(this).toggleClass("showDetail");$(this).next(".awardDetailSetting").toggle();$$("#awardCusTextInfo").toggle()});$(".config-tab-content").on("change","input[name='jumpLinkBtn']",function(){var e=$(this).val();if(e==1){$("#set_jumpLink2_box").hide().find("input").attr("disabled","disabled")}else{if(e==2){$("#set_jumpLink2_box").show().find("input").removeAttr("disabled")}}});$("input[name='hideOrganizerLogo']").change(function(){var e=$(this).val();if(e==1){$(".orgLogoControls").hide().find("input").attr("disabled","disabled");$$(".organizer-btn").hide()}else{$(".orgLogoControls").show().find("input").removeAttr("disabled");$$(".organizer-btn").show()}});$("input[name='isOpenClick']").change(function(){if($(this).val()==0){$(".openClickControls").hide().find("input").attr("disabled","disabled");$$(".openClick-btn").hide()}else{$(".openClickControls").show().find("input").removeAttr("disabled");$$(".openClick-btn").show()}});$("input[name='useDefaultCopyright']").change(function(){var e=$(this).val();if(e==1){$(".copyrightPicControls").hide().find("input").attr("disabled","disabled")}else{$(".copyrightPicControls").show().find("input").removeAttr("disabled")}});$("input[name='useDefaultLoadPage']").change(function(){var e=$(this).val();if(e==1){$(".loadPagePicControls").hide().find("input").attr("disabled","disabled")}else{$(".loadPagePicControls").show().find("input").removeAttr("disabled")}});$(".award_tab_content").on("change","input[name='guanwanJumpBtn']",function(){var e=$(this).val();if(e==1){$$("#jumpBtn").hide();$(this).parents(".controls").find(".jumpBtnNameBox").hide().find(".jumpBtnName").attr("disabled","disabled");$(this).parents(".controls").find(".jumpLinkBox").hide().find(".jumpLink").attr("disabled","disabled")}else{$$("#jumpBtn").show();$(this).parents(".controls").find(".jumpBtnNameBox").show().find(".jumpBtnName").removeAttr("disabled");$(this).parents(".controls").find(".jumpLinkBox").show().find(".jumpLink").removeAttr("disabled")}});$(".award_tab_content").on("keyup","input[name='jumpBtnName']",function(){$$("#jumpBtn").find(".text").text($(this).val())});$("input[name='totalLotteryCountRadio']").change(function(){var e=$(this).val();if(e==1){$("#totalLotteryCount").attr("disabled","disabled")}else{$("#totalLotteryCount").removeAttr("disabled")}});$("input[name='gameTimeRadio']").change(function(){var e=$(this).val();if(e==0){$("#gameTime").attr("disabled","disabled")}else{$("#gameTime").removeAttr("disabled")}});$("input[name='shareType']").change(function(){var f=$(this).val();if(f==0){$("#wxshare_box").hide();$("#wxshare_box").find("input").attr("disabled","disabled");$("#set_qrcodebg_box").show();$("input[name='useDefaultQrcodeBg']").removeAttr("disabled");var i=$("input[name='useDefaultQrcodeBg']:checked").val();if(i==1){$(".qrcodeBgControls").hide().find("input").attr("disabled","disabled")}else{$(".qrcodeBgControls").show().find("input").removeAttr("disabled")}}else{$("#set_qrcodebg_box").hide();$("#set_qrcodebg_box").find("input").attr("disabled","disabled");$("#wxshare_box").show();$("input[name='useShareIco'], input[name='useShareTxt'], input[name='useShareTitle']").removeAttr("disabled");var e=$("input[name='useShareIco']:checked").val();var h=$("input[name='useShareTxt']:checked").val();var g=$("input[name='useShareTitle']:checked").val();if(e==1){$("#share_ico_controls").hide().find("input").attr("disabled","disabled")}else{$("#share_ico_controls").show().find("input").removeAttr("disabled")}if(h==1){$("#share_txt_controls").hide();$("input[name='checkShareTxt']").val(1)}else{$("#share_txt_controls").show();$("input[name='checkShareTxt']").removeAttr("disabled")}if(g==1){$("#share_title_controls").hide();$("input[name='checkShareTxt']").val(1)}else{$("#share_title_controls").show();$("input[name='checkShareTxt']").removeAttr("disabled")}}});$("input[name='useDefaultQrcodeBg']").change(function(){var e=$(this).val();if(e==1){$(".qrcodeBgControls").hide().find("input").attr("disabled","disabled")}else{$(".qrcodeBgControls").show().find("input").removeAttr("disabled")}});$("input[name='useShareIco']").change(function(){var e=$(this).val();if(e==1){$("#share_ico_controls").hide().find("input").attr("disabled","disabled")}else{$("#share_ico_controls").show().find("input").removeAttr("disabled")}});$("input[name='useShareTxt']").change(function(){var e=$(this).val();if(e==1){$("#share_txt_controls").hide();$("input[name='checkShareTxt']").val(1)}else{$("#share_txt_controls").show()}});$("input[name='useShareTitle']").change(function(){var e=$(this).val();if(e==1){$("#share_title_controls").hide();$("input[name='checkShareTxt']").val(1)}else{$("#share_title_controls").show().find("input").removeAttr("disabled")}});insertShareTxt();$("#title").on("keyup",function(){$("#actName").text($(this).val())});$("#globalProbability").on("keyup",function(){$(".globalProbabilityText").text($(this).val())});$("#ruleTips").on("keyup",function(){$$("#rule_content_text").html($.htmlEncode($(this).val()))});$("#organizer").on("keyup",function(){$$(".organizer").html($.htmlEncode($(this).val()))});if($("#set_bless_box").length>0){$("#bless").on("keyup",function(){$$("#bless").text($(this).val())})}if($("#set_seller_name_box").length>0){$("#seller_name").on("keyup",function(){$$("#seller_name").text($(this).val())})}$("input[name='showCopyright']").on("change",function(){if($(this).val()==2){$$("#start_bottom").hide()}else{$$("#start_bottom").show()}});$("input[name='open_opening_link']").on("change",function(){if($("input[name='open_opening_link']:checked").val()==0){$("#opening_link, #set_openClick_box").hide();$(".openClickControls").hide().find("input").attr("disabled","disabled");$$(".openClick-btn").hide()}else{$("#opening_link, #set_openClick_box").show();if($("input[name='isOpenClick']:checked").val()==0){$(".openClickControls").hide().find("input").attr("disabled","disabled");$$(".openClick-btn").hide()}else{$(".openClickControls").show().find("input").removeAttr("disabled");$$(".openClick-btn").show()}}});$("#securityLevel-alert-modal-1 .securityLevel-alert-confirm").click(function(){if($(this).hasClass("disabled")){return}$("#securityLevel-alert-modal-1").modal("hide");$("input[name='securityLevel'][value='1']").attr("checked","checked").trigger("change",true)});$("#securityLevel-alert-modal-2 .securityLevel-alert-confirm").click(function(){if($(this).hasClass("disabled")){return}$("#securityLevel-alert-modal-2").modal("hide");$("input[name='securityLevel'][value='2']").attr("checked","checked").trigger("change",true)});$("#securityLevel-alert-modal-3 .securityLevel-alert-confirm").click(function(){if($(this).hasClass("disabled")){return}$("#securityLevel-alert-modal-3").modal("hide");$("input[name='securityLevel'][value='3']").attr("checked","checked").trigger("change",true)});$(".securityLevel-alert-modal input[name='securityLevel_alert_check']").change(function(){var e=$(this).closest(".securityLevel-alert-modal");if($(this).is(":checked")){$(".securityLevel-alert-confirm",e).removeClass("disabled")}else{$(".securityLevel-alert-confirm",e).addClass("disabled")}});$("input[name='securityLevel']").on("click",function(g){var f=$("input[name='securityLevel']:checked").val();if(f==1){$("#securityLevel-alert-modal-1").modal("show")}else{if(f==2){$("#securityLevel-alert-modal-2").modal("show")}else{if(f==3){$("#securityLevel-alert-modal-3").modal("show")}}}g.stopPropagation();return false});$("input[name='securityType']").change(function(){var e=$("input[name='securityType']:checked").val();if(e==1){$("label[for='smsfreeze_total']").text("预计短信验证量：");$("label[for='sms_total']").text("账户短信余额：")}else{$("label[for='smsfreeze_total']").text("预计语音验证量：");$("label[for='sms_total']").text("账户语音余额：")}});$("input[name='securityLevel']").on("change",function(m){var k=$("input[name='securityLevel']:checked").val();if(k==1){$("#securityLevel_1_tips").show();$("#securityLevel_2_tips").hide();$("#security_type_group").hide()}else{if(k==2||k==3){$("#security_type_group").show();if(k==2){$("#securityLevel_2_tips .tips2").show();$("#securityLevel_2_tips .tips3").hide()}else{$("#securityLevel_2_tips .tips2").hide();$("#securityLevel_2_tips .tips3").show()}var f=$(".award_tab_item>li.prize_tab_item").length;var g=0;for(var j=0;j<f;j++){var l=$(".award_tab_item>li.prize_tab_item").eq(j);if(!l.hasClass("hide")&&$(".award_tab_"+j+" select[name='awardType']").val()==2){g+=parseInt($(".award_tab_"+j+" input[name='awardRealNum']").val())}}$("#securityLevel_2_tips").show().find("#smsfreeze_total").text(g);var h={};$.ajax({url:"./zp_files/query_account_by_uid.html",timeout:15000,type:"post",dataType:"json",data:h,success:function(e){if(e.ret==0){console.log(e);if(e.model.isjoin_sms100){$("#securityLevel_2_tips").find(".sms_free_join").hide()}$("#securityLevel_2_tips").show().find("#sms_total").text(e.model.simAccount.enableNum)}else{alert(e.msg)}},error:function(e,n,i){alert("服务器正在紧张的运行中，请稍后再试")}});$("#securityLevel_1_tips").hide();$("#securityLevel_2_tips").show()}}});$("input[name='awardSendType']").on("change",function(){if($("input[name='awardSendType']:checked").val()==1){$("#lucky_award_box").hide().find("input").attr("disabled","disabled");$(".help-inline-awardSendType2").hide();$(".help-inline-awardSendType1").show();$(".helpType_1_cont").hide();$(".helpType_2_cont").show();$("#helpType").val(2);$$(".rank_btn").show();$(".set_defaultWinner_box").hide()}else{$("#lucky_award_box").show().find("input").removeAttr("disabled","disabled");if($("input[name='totalLotteryCountRadio']:checked").val()==1){$("#totalLotteryCount").attr("disabled","disabled")}else{$("#totalLotteryCount").removeAttr("disabled")}$(".help-inline-awardSendType1").hide();$(".help-inline-awardSendType2").show();$(".helpType_1_cont").show();$(".helpType_2_cont").hide();if($("input[name='helpEffect']:checked").val()==0){$("#helpType").val(1)}else{$("#helpType").val(4)}$$(".rank_btn").hide();$(".set_defaultWinner_box").show()}showTabByStyle($("input[name='awardSendType']:checked").val())});$("input[name='helpEffect']").on("change",function(g,f){if(f==0||$(this).val()==0){$("#lotteryCount").show();$("#helpAward").hide();$("#lotteryCount").find("input").removeAttr("disabled");$("#helpAward").find("input").attr("disabled","disabled");$("#helpType").val(1);$("#set_daylimit_box .help-inline-1").show();$("#set_daylimit_box .help-inline-2").hide()}else{$("#helpAward").show();$("#lotteryCount").hide();$("#helpAward").find("input").removeAttr("disabled");$("#lotteryCount").find("input").attr("disabled","disabled");$("#helpType").val(4);$("#set_daylimit_box .help-inline-1").hide();$("#set_daylimit_box .help-inline-2").show()}});$("input[name='exchangeLimit']").change(function(){var e=$(this).val();if(e==1){$("#set_exchangeLimitDetail_box").show()}else{$("#set_exchangeLimitDetail_box").hide()}});$("input[name='exchangeLimitPhone']").change(function(){var e=$(this).val();var f=$(this).closest(".controls").find(">p");if(e==1){f.show()}else{f.hide()}});$("input[name='exchangePayWay']").change(function(){var f=$(this).val();if(f==1){var e=false;if(hasPublish){e=true}$(".award_tab").each(function(){var g=$(this).find('input[name="cls_bargain_min_price"]');g.attr("disabled",e)})}else{$(".award_tab").each(function(){var g=$(this).find('input[name="cls_bargain_min_price"]');g.val("0");g.attr("disabled",true)})}});$("input[name='hideParticipant']").on("change",function(){if($(this).val()==1){$$("#join_line_cont").hide()}else{$$("#join_line_cont").show()}});$("input[name='useDefaultCopyright']").on("change",function(){if($(this).val()==1){$$("#startLogoImg").attr("src",static_res_prefix+"/content/bigwheel/back/files/lot/yylogo.png")}else{$$("#startLogoImg").attr("src",user_img_domain+$("#customCopyrightPic").val())}});$("input[name='useDefaultQrcodeBg']").on("change",function(){if($(this).val()==1){$$("#help_qrcode_img").attr("src",_resRoot+"/share.png")}else{$$("#help_qrcode_img").attr("src",user_img_domain+$("#shareQrcodeBg").val())}});$("#startDate,#endDate").change(function(){var e=$("#startDate").datetimepicker("getDate").Format("yyyy年MM月dd日");var f=$("#endDate").datetimepicker("getDate").Format("yyyy年MM月dd日");$$("#rule_time").html(e+"~"+f)});$("input[name='awardName'],input[name='trophyName']").live("keyup",function(){var e=$(".prize_tab_item ").not(".hide").length;var f="";for(var g=0;g<e;g++){f+="<p>";f+=$(".award_tab_"+g+" input[name='awardName']").val();f+="：";f+=$(".award_tab_"+g+" input[name='trophyName']").val();f+="</p>"}$$("#rule_award").html(f)});$(".add_redpack_award").live("click",function(){var f=$(this).data("awardid");var e=$("#add_redpack_modal");e.modal("show");e.attr("data-awardid",f)});$(".add_sncode_award").live("click",function(){var i=$(this).data("awardid");var g=$(this).parent();var f=$(this).closest(".award_detail_form");var h=$("#add_sncode_award_modal");h.modal("show");h.attr("data-awardid",i);var e=f.find("input[name='sncodeType']:checked").val();console.log(e);$("input[name='award_unsend_num']",h).val(g.find("input[name='awardRealNum']").val());$("input[name='award_send_num']",h).val(g.find("input[name='awardLoseNum']").val());if(e==3){$("textarea[name='sncodes']",h).removeAttr("disabled");$(".j-sncode-cont",h).show();$("textarea[name='sncodes']",h).val(f.find("textarea[name='sncodes']").val());h.find(".j-check-sncode").off("click").on("click",function(){sncodeCheck($(this))})}else{$("textarea[name='sncodes']",h).attr("disabled","disabled").val("");$(".j-sncode-cont",h).hide()}});$(".award_tab_content").on("keyup","input[name='trophyName']",function(){$$("#trophyNamePhoneTxt").text($(this).val())});$(".award_tab_content").on("change","input[name='validityStart']",function(){$$("#validityStartPhoneTxt,#validityStartPhoneTxt1").text($(this).val().substring(0,10).replace(/\-/g,"."))});$(".award_tab_content").on("change","input[name='validityStop']",function(){$$("#validityStopPhoneTxt,#validityStopPhoneTxt1").text($(this).val().substring(0,10).replace(/\-/g,"."))});$(".award_tab_content").on("keyup","input[name='subhead']",function(){$$("#subheadPhoneTxt").text($(this).val())});$(".award_tab_content").on("keyup","input[name='operationTip']",function(){$$("#operationTipPhoneTxt").text($(this).val())});$(".award_tab_content").on("keyup","input[name='storeAddress']",function(){$$("#storeAddressPhoneTxt").text($(this).val())});$(".award_tab_content").on("keyup","textarea[name='description']",function(){$$("#descriptionPhoneTxt").text($(this).val())});var d=$("#form_add_redpack_setting").validate({onfocusout:false,rules:{add_redpack_num:{required:true,awardNum:true},add_redpack_amount:{required:true,number:true,min:1,max:400000,validateAddRedpackTotalMoney:true}},messages:{add_redpack_num:{required:"不能为空",maxlength:"长度不能大于30"},add_redpack_amount:{required:"不能为空",number:"必需为数值",min:"数值至少为1",max:"数值最大为400000"}},showErrors:function(e,g){if(g&&g.length>0){$.each(g,function(h,j){var i=$(j.element);if(i.is(".cover")){alert(j.message)}i.closest(".control-group").addClass("error");i.attr("title",j.message)})}else{var f=$(this.currentElements);f.closest(".control-group").removeClass("error");f.removeAttr("title")}},submitHandler:function(){var h=$("#add_redpack_modal").data("awardid");var g=$("#add_redpack_confirm");var e=$("#form_add_redpack_setting");if(g.hasClass("disabled")){return}var f={awardId:h,addValue:Math.round(Number($("#add_redpack_amount",e).val())*100),addNum:$("#add_redpack_num",e).val()};g.addClass("disabled");$.ajax({url:"/admin/new_activity/add_redpack",timeout:15000,type:"post",dataType:"json",data:f,success:function(j){if(j.ret==0){var i=j.model;unbindBeforeUnload();alert("红包追加成功");window.location.reload()}else{alert(j.msg)}g.removeClass("disabled")},error:function(i,k,j){alert("服务器正在紧张的运行中，请稍后再试");g.removeClass("disabled")}})}});var c=$("#form_add_sncode_award_setting").validate({onfocusout:false,rules:{award_unsend_num:{required:true,number:true,awardNum:true,min:1,max:400000},sncodes:{required:true,snCode:true}},messages:{award_unsend_num:{required:"不能为空",number:"必需为数值",min:"数值至少为1",max:"数值最大为400000"},sncodes:{required:true,snCode:"券号格式错误"}},showErrors:function(e,g){if(g&&g.length>0){$.each(g,function(h,j){var i=$(j.element);if(i.is(".cover")){alert(j.message)}i.closest(".control-group").addClass("error");i.attr("title",j.message)})}else{var f=$(this.currentElements);f.closest(".control-group").removeClass("error");f.removeAttr("title")}},submitHandler:function(){var i=$("#add_sncode_award_modal").data("awardid");var g=$("#add_sncode_award_confirm");var e=$("#form_add_sncode_award_setting");if(g.hasClass("disabled")){return}var h=parseInt($('input[name="award_unsend_num"]',e).val())+parseInt($('input[name="award_send_num"]',e).val());var f={awardId:i,updateNum:h};if(!$('textarea[name="sncodes"]',e).is(":disabled")){f.snList=$('textarea[name="sncodes"]',e).val().split(/\n/g).toString()}g.addClass("disabled");$.ajax({url:"/admin/new_activity/update_snaward",timeout:15000,type:"post",dataType:"json",data:f,success:function(k){if(k.ret==0){var j=k.model;unbindBeforeUnload();alert("奖品数量修改成功");window.location.reload()}else{alert(k.msg)}g.removeClass("disabled")},error:function(j,l,k){alert("服务器正在紧张的运行中，请稍后再试");g.removeClass("disabled")}})}});$("#passCondition").on("keyup",function(){$$("#resule-status-minscore .prize_score").text($(this).val())});$("input[name='totalCount']").live("keyup",function(){var e=Number($(this).val());var f=$(this).closest(".control-group");if(e>10){f.find(".service_charge").text((e*0.03).toFixed(2))}else{f.find(".service_charge").text(0)}});$("input[name='add_redpack_amount']").live("keyup",function(){var e=$(this).closest("#form_add_redpack_setting");e.find(".service_charge").text(($(this).val()*0.03).toFixed(2))});$("body").on("change",'input[name="withdrawThresholdRadio"]',function(){var e=$(this).val();if(e==1||e==3){$(this).closest(".radio").siblings(".withdrawThreshold_min").hide()}else{$(this).closest(".radio").siblings(".withdrawThreshold_min").show().css({display:"inline-block","padding-top":"0"})}});$.validator.addMethod("singleMax",function(g,f,i){if(!_isZcqc){var e=Number(g);var h=Number($(f).parent().find("input[name='singleMin']").val());return e>=h}else{var e=Number(g);var h=Number($(f).parent().find("input[name='singleMin']").val());if(h<0.1||h>5||e>5||e<0.1){return false}return e>=h}},"红包最大值取值必需大于最小值");$.validator.addMethod("snCode",function(f,e,g){return sncodeCheck($(e).closest(".controls").find(".j-check-sncode"))},"券号格式错误");$.validator.addMethod("awardNum",function(f,e,g){return awardNumCheck($(e),10000)},"奖品总数量在1-10000之间");$.validator.addMethod("defaultWinnerAmount",function(h,g,i){var f=Number($(g).closest(".award_detail_form").find("input[name='awardRealNum']").val());var e=Number(h);return e>0&&e<=f},"内定奖品数量必须大于0且不能大于奖品数量");$.validator.addMethod("probabilityValueTotal",function(g,f,h){var e=0;$(".prize_tab_item:not('.hide')").each(function(){var i=$(this).children("a").attr("data-idx");var j=Number($(".award_tab_"+i).find("input[name='probabilityValue']").val());e=e+j});return e<=100},"所有奖项中奖概率之和不能大于100%");$.validator.addMethod("validityStop",function(h,e,i){var g=$(e).closest("form").find("input[name='validityStart']");var f=$(e);g.datetimepicker("setDate",g.val());f.datetimepicker("setDate",f.val());return f.datetimepicker("getDate")>g.datetimepicker("getDate")},"兑奖结束时间必须大于开始时间");$.validator.addMethod("validateTotalMoney",function(k,h,g){if(_isYyttl){return true}var m=$(h).closest("form");var j=m.find("select[name='awardType']").val();if(j!=2){return true}var i=Number(m.find("input[name='totalCount']").val());var f=Number(m.find("input[name='awardRealNum']").val());var l=Number(m.find("input[name='singleMax']").val());var e=Number(m.find("input[name='singleMin']").val());return i>=Number((f*e).toFixed(2))&&i<=Number((f*l).toFixed(2))},"总金额不正确，必须符合：（单个红包最小金额×总数量）<总金额<（单个红包最大金额×总数量）");$.validator.addMethod("validateAddRedpackTotalMoney",function(l,h,g){if(_isYyttl){return true}var n=$("#add_redpack_modal").data("awardid");var o=$(h).closest("form");var m=$(".award_detail_form[data-awardid='"+n+"']");var j=m.find("select[name='awardType']").val();if(j!=2){return true}var i=Number(o.find("input[name='add_redpack_amount']").val());var f=Number(o.find("input[name='add_redpack_num']").val());var k=Number(m.find("input[name='singleMax']").val());var e=Number(m.find("input[name='singleMin']").val());return i>=Number((f*e).toFixed(2))&&i<=Number((f*k).toFixed(2))},"总金额不正确，必须符合：（单个红包最小金额×总数量）<总金额<（单个红包最大金额×总数量）")};function pageChange(){$("input,textarea").keydown(function(){$(this).unbind("keydown");$(window).bind("beforeunload",function(b){var a="离开页面内容将会消失";b.returnValue=a;return a})})}function unbindBeforeUnload(){$(window).unbind("beforeunload")}function initBecomeGrey(){if($("input[name=probabilityType]")[0].checked){$("input[name='globalProbability']").attr("disabled","disabled");$("#set_probabilityMode_box").css("color","grey");$("#set_probabilityMode_box input[type=radio]").attr("checked",false)}else{$("#set_probabilityType_box").css("color","grey")}ShowProbabilityInfo()}function cancelProbabilityType(){$("#set_probabilityMode_box").css("color","#000");$("#globalProbability").removeAttr("disabled");$("#set_probabilityType_box").css("color","grey");$("#probabilityType").attr("checked",false);ShowProbabilityInfo()}function ShowProbabilityInfo(){if($("#probabilityType").is(":checked")){$("#set_probabilityMode_box .probabilityInfo").css("color","#ff4c4c");$("#set_probabilityMode_box .probabilityInfo").text("（概率派奖已失效）");$("#set_probabilityType_box .probabilityInfo").css("color","#0099e5");$("#set_probabilityType_box .probabilityInfo").text("（按照均匀派奖）")}else{$("#set_probabilityMode_box .probabilityInfo").css("color","#0099e5");$("#set_probabilityMode_box .probabilityInfo").text("（按照概率派奖）");$("#set_probabilityType_box .probabilityInfo").css("color","#ff4c4c");$("#set_probabilityType_box .probabilityInfo").text("（均匀发放已失效）")}}(function(){initActivity();pageChange();if(isEdit||isReCreate){load_activity(global_aid);$(".edit_title").show()}else{load_default_template();$(".add_title").show()}})();