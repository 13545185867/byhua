function showEditByGame(o,e,m){var g=$(this);if(m&&m[0]&&m[0].callback&&typeof m[0].callback=="function"){m[0].callback();return}if(o==-1){$("#upload_img_modal").modal("show");var c=$("#upload_img_modal .modal-body");c.html("");for(var n=0;n<m.length;n++){var q=m[n];if(!q.extend){q.extend={}}q.index=n;if(!q.imgtype){q.imgtype="common"}var p=getJqSrc($$(q.from),true);var d=q.size||"--px*--px";q.img_src=p;q.recover=getImgName(p)!=getImgName(q.defSrc);var s='图片像素建议为 <span class="uploadSize uploadSize-'+n+'">'+d+"</span><br>大小在"+q.limit+'以内，格式为jpg\\bmp\\png\\gif<div class="sanjiao"></div>';q.infoText=s;var l=document.getElementById("upload_img_field_tpl").text;var a=$.template(l).render(q);$("#upload_img_modal .modal-body").append(a);(function(b){GameImgReady(q.defSrc,function(){$(".uploadSize-"+b).html(this.width+"px*"+this.height+"px")})})(n)}initFileUpload($("#upload_img_modal input[name='fileupload']"),function(b,i){i.find(".cover-recovery").show()})}else{if(o==5){editCheckText(g,e)}else{if(o==6){for(var n=0;n<m.length;n++){var q=m[n];if(!q.extend){q.extend={}}q.index=n;if(!q.imgtype){q.imgtype="common"}var p=getJqSrc($$(q.from),true);$("#upload_music_modal").find(".control-group").eq(n).find(".music_area").attr("data-defsrc",q.defSrc);var t=$("#upload_music_modal").find(".control-group").eq(n).find(".upload_music_1_1").val();if(t&&q.defSrc!=t){$("#upload_music_modal").find(".control-group").eq(n).find(".music_cover-recovery").show()}else{$("#upload_music_modal").find(".control-group").eq(n).find(".music_cover-recovery").hide()}$("#upload_music_modal").find(".control-group").eq(n).find(".music_name").text(t?t:q.defSrc)}var r=document.cookie.split("; ");for(var f=0;f<r.length;f++){if(r[f].indexOf("disclaimer_music")==0){$("#upload_music_modal").modal("show");break}else{if(f==r.length-1){$("#disclaimer_modal").modal("show")}}}}else{if(o==11){var h=$("#jiwufu_gametext_modal");h.modal("show")}else{if(o==12){var u=$("#newshakeredpack_redpacktext_modal");u.modal("show")}else{if(o==13){$("#valuationHunter_goodsImg_modal").show()}else{if(o==15){$("#upload_truth_modal").modal("show")}else{addFieldCheckBorder(e)}}}}}}}}function editCheckText(b,a){$("#range_edit_text").off("keyup");$("#range_edit_color").off("keyup");$("#edit_text_modal").modal("show");var c={};c.value=$$(b).text()||"";c.color=rgb2hex($$(b).css("color"))||"#000000";c.size=$$(b).css("fontSize").replace("px","")||"12";$("#range_edit_text").val(c.value);if($$(b).attr("id")=="qrcode_edit_represent_text"||$$(b).attr("id")=="qrcode_edit_title_text"){$("#range_edit_text").attr("readonly",true)}else{$("#range_edit_text").attr("readonly",false)}$("#range_edit_color").val(c.color).trigger("keyup");progressBar(b,c.size);$("#range_edit_text").on("keyup",function(){$$(b).html($("#range_edit_text").val())});$("#range_edit_color").on("keyup",function(){$$(b).css("color",$("#range_edit_color").val())});$("#edit_text_modal").off("click","j-reback-color").on("click",".j-reback-color",function(){var d=$$(b).data("color");var e=rgb2hex(d)||"#000000";$("#range_edit_color").val(e).trigger("keyup");return false});$("#edit_text_modal").off("click","j-reback-text").on("click",".j-reback-text",function(){var d=$$(b).data("text")||"新增文本";$("#range_edit_text").val(d).trigger("keyup");return false})}function progressBar(c,h){var e=$("#progress_control");var a=false;var g=e.find(".progress").width();var b=f(h)||0;i(b);e.off("mousedown",".j-bar-control").on("mousedown",".j-bar-control",function(){a=true;return false});e.off("mousemove",".progress").on("mousemove",".progress",function(j){if(a){i(j.offsetX)}return false});e.off("mouseup").on("mouseup",function(){a=false;return false});e.off("click","j-reback-size").on("click",".j-reback-size",function(){var j=$$(c).data("size")||"12px";var k=f(j)||0;i(k);return false});function i(l){var k=0;if((l<=g)||(l>=0)){k=l}else{if(l>g){k=g}else{k=0}}var j=d(k);$$(c).css("fontSize",j);e.find(".j-bar-value").html(j);e.find(".j-bar-line").width(k+"px");e.find(".j-bar-control").css("left",k+"px")}function d(k){var j=parseInt(k);return Math.round(j/(g/30)+10)+"px"}function f(k){var j=parseInt(k);return Math.round((j-10)*g/30)}}function rgb2hex(a){a=a.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);function b(c){return("0"+parseInt(c).toString(16)).slice(-2)}return"#"+b(a[1])+b(a[2])+b(a[3])}function genRandomNum(a){var c=[];for(var b=0;b<a;b++){c.push(Math.floor(Math.random()*10))}return c.join("")}GameImgReady=(function(){var g=[],h=null,e=function(){var a=0;for(;a<g.length;a++){g[a].end?g.splice(a--,1):g[a]()}!g.length&&f()},f=function(){clearInterval(h);h=null};return function(s,d,b,o){var c,r,a,p,t,q=new Image();q.src=s;if(q.complete){d.call(q);b&&b.call(q);return}r=q.width;a=q.height;q.onerror=function(){o&&o.call(q);c.end=true;q=q.onload=q.onerror=null};c=function(){p=q.width;t=q.height;if(p!==r||t!==a||p*t>1024){d.call(q);c.end=true}};c();q.onload=function(){!c.end&&c();b&&b.call(q);q=q.onload=q.onerror=null};if(!c.end){g.push(c);if(h===null){h=setInterval(e,40)}}}})();function addFieldCheckBorder(c){var d=$("#set_"+c+"_box");var b=d.closest(".config_view").index();$("#configTab>li").eq(b).click();if(d.closest("#adv_subtab_content").size()>0){var a=d.closest(".tab-pane").index();$("#adv_subtab>li").eq(a).find(">a").click()}d.addClass("checkBorder")}function getJqSrc(c,a){var e="";if(c.attr("src")){e=c.attr("src")}else{if(c.val()){e=c.val()}else{if(c.css("background-image")){var d=c.css("background-image");var b=d.match(/url\("(.+)"\)/)||d.match(/url\('(.+)'\)/)||d.match(/url\((.+)\)/);if(b){e=b[1]}}}}if(a){return e}else{return e.replace(_resRoot,"*_resRoot*").replace(_qiniuResRoot,"*_qiniuResRoot*")}}function setJqSrc(a,b){a.each(function(){var c=$(this)[0].nodeName;if(/img/i.test(c)){$(this).attr("src",b)}else{if(/input/i.test(c)){$(this).val(b)}else{$(this).css("background-image",'url("'+b+'")')}}})}function getImgName(c){var d=c.match(/\/([^\.\/]+?\.\w+)($|\?)/i);if(d===null){return false}return d[1]}function removeItemByGame(e,c,b,a){$(this).remove()}function showCssByGame(k,i){if(k=="gameTopBar"){HdPortal.popupWindow({title:"样式设置",frameSrcUrl:"manage/gameTopBar.jsp?ram="+Math.random(),width:425,height:125,frameWidth:"445px",frameHeight:"350px",frameOverFlow:true});return}if(k=="joinNum"){HdPortal.popupWindow({title:"样式设置",frameSrcUrl:"manage/joinNum.jsp?ram="+Math.random()+"&isSelf="+isSelAwardLine+"&id="+g_id,width:465,height:240,frameWidth:"485px",frameHeight:"485px",frameOverFlow:true});return}var h=$("#uploadBg");var l=$("#uploadImgBox");var g=$("#uploadInfoBox");l.removeClass("uploadUp").addClass("uploadDown");h.fadeIn(200);$("#uploadImgBox .updTopBar .title span").text("样式设置");l.css("left",$(".editDetail").offset().left+12);g.css("padding-top","15px");g.css("margin-left","2px");g.html("");var j=getPreviewWin().musicList;g.append('<div class="poupContent cssEditContent"></div>');$.each(i,function(r,d){var f=$$(d.from);f.data("_cssEditArg",d);if(d.css){var e=$('<div>\n<span class="title">'+d.title+"：</span>\n"+(typeof d.opt==="undefined"?"":('<input id="cssDefault-'+r+'" class="cssDefault" type="radio" name="cssOpt-'+r+'" checked><label for="cssDefault-'+r+'">默认</label>\n<input id="cssSelf-'+r+'" class="cssSelf" type="radio" name="cssOpt-'+r+'" ><label for="cssSelf-'+r+'">自定义</label>'))+'<div class="setBox"></div></div>');var a=e.find(".setBox");for(var b=0;b<d.css.length;b++){a.append(getSetLine(d.css[b],f,r,b))}var c=e.find(".cssDefault");var q=e.find(".cssSelf");c.on("click",function(){a.find(".setLine").each(function(n,m){var o=$("el").find(".defSet");if(o.length>0){o.click()}else{var p=d.css[n];setColor(f,p,true);p.opt=0}});a.hide();d.opt=0});q.on("click",function(){a.find(".setLine").each(function(m,p){var n=$("el").find(".selfSet");if(n.length>0){n.click()}else{var o=d.css[m];setColor(f,o);o.opt=1}});a.show();d.opt=1});g.find(".cssEditContent").append(e);if(d.opt){q.click().attr("checked","checked")}else{c.click().attr("checked","checked")}e=null}else{g.find(".cssEditContent").append(getSetLine(d,f,0,r))}})}function parsePxToRem(a){if(typeof a=="number"){return(parseInt(a)/20<=0?2:parseInt(a)/20)+"rem"}return parseInt(a)/20+"rem"}function parseRemToPx(a){if(a.indexOf("rem")===-1){return parseFloat(a)}return parseFloat(a)*40}function recoveryImg(b,a){setJqSrc($$(b),a)}function parsedQrcodePageArg(a,d,l,j){var g,p,o,h,f;if(a){if(typeof a==="string"){f=a;a=$$("#"+a);a.length===0&&(a=$$("."+f));if(a.length===0){if(!((f==="qrcode_edit_headimg"||f==="qrcode_edit_codeimg")&&false)){window.errorTarget=f;alert("二维码自定义编辑页面编辑数据错误，请重新检查")}return false}}h=a.parents(".ui-wrapper");if(h.length===0){h=a}g={left:parseFloat(h.css("left")),top:parseFloat(h.css("top"))};p={width:parseFloat(h.width()),height:parseFloat(h.height())};o=getJqSrc(a);if(o==""){window.errorTarget=a.selector;return false}}if(d){o={};var c=false;if(d[0].indexOf("editTarget")!==-1){o=[];c=true}if(!l){l=d}for(var e=0,b=d.length;e<b;e++){var k=null;if(d[e] instanceof jQuery){k=d[e]}else{k=$$("#"+d[e]);if(k.length===0){k=$$("."+d[e])}}var m=k.attr("src");if(getJqSrc(k)==""){return false}if(c){o[e]=getJqSrc(k)}else{o[l[e]]=getJqSrc(k)}}}if(!g&&!p&&!o){return false}if(isNaN(g.left)){g.left=38}if(isNaN(g.top)){g.top=190}if(isNaN(p.width)){p.width=100}if(isNaN(p.height)){p.height=100}return{position:g,size:p,path:o}}function parsedGameArg(a,d,l,j){var g,p,o,h,f;if(a){if(typeof a==="string"){f=a;a=$$("#"+a);a.length===0&&(a=$$("."+f));if(a.length===0){if(!((f==="rule_tag_img"||f==="startBtnImg"||f==="titleImg"||f==="organizer_logo"||f==="openClick_pic")&&false)){window.errorTarget=f;alert("自定义编辑数据错误，请重新检查")}return false}}h=a.parents(".ui-wrapper");if(h.length===0){h=a}g={left:parsePxToRem(h.css("left")),top:parsePxToRem(h.css("top"))};p={width:parsePxToRem(h.width()),height:parsePxToRem(h.height())};g=$.toJSON(g);p=$.toJSON(p);o=getJqSrc(a);if(o==""){window.errorTarget=a.selector;return false}}if(d){o={};var c=false;if(d[0].indexOf("editTarget")!==-1){o=[];c=true}if(!l){l=d}for(var e=0,b=d.length;e<b;e++){var k=null;if(d[e] instanceof jQuery){k=d[e]}else{k=$$("#"+d[e]);if(k.length===0){k=$$("."+d[e])}}var m=k.attr("src");if(getJqSrc(k)==""){return false}if(c){o[e]=getJqSrc(k)}else{o[l[e]]=getJqSrc(k)}}o=$.toJSON(o)}if(!g&&!p&&!o){return false}return{pos:g,size:p,path:o}}function parsedTextArg(){var b=$$("#qrcode_edit_page");var a=[];b.find(".j-text-poster").each(function(){var c={};c.position={};c.position.left=$(this).css("left").replace("px","");c.position.top=$(this).css("top").replace("px","");c.font={};c.font.size=$(this).css("fontSize").replace("px","");c.font.color=rgb2hex($(this).css("color")).replace("#","");c.size={};c.size.width=$(this).width();c.size.height=$(this).height();c.content=$(this).text()+"";a.push(c)});return a}function parsedTextNode(a){var b=$$("#"+a);var c={};c.position={};c.position.left=b.css("left").replace("px","");c.position.top=b.css("top").replace("px","");c.font={};c.font.size=b.css("fontSize").replace("px","");c.font.color=rgb2hex(b.css("color")).replace("#","");c.size={};c.size.width=b.width();c.size.height=b.height();c.content=b.text()+"";if(b.css("display")!="none"){c.showState="1"}else{c.showState="0"}return c}function parsedBgImg(a,c){var b=$$("#"+a);var d={};d.position={};d.position.left=0;d.position.top=0;if(c&&c=="1"){d.position.bottom=0}d.size={};d.size.width=b.width();d.size.height=b.height();d.size.rawwidth=b.attr("data-rawwidth");d.size.rawheight=b.attr("data-rawheight");d.path=b.attr("src");d.showState=true;if(b.css("display")!="none"){d.showState="1"}else{d.showState="0"}return d}function genQrcodeEditPageJson(){var c={};var h=getPreviewWin();var d=parsedQrcodePageArg("qrcode_edit_headimg");var b=parsedQrcodePageArg("qrcode_edit_codeimg");var g=parsedBgImg("qrcode_edit_bgimg");var f=parsedTextNode("qrcode_edit_represent_text");var a=parsedTextNode("qrcode_edit_title_text");var e=parsedTextArg();if(d){c.headerImg=d;c.headerImg.showState="1";if($$("#qrcode_edit_headimg").css("display")!="none"){c.headerImg.showState="1"}else{c.headerImg.showState="0"}}else{return false}if(b){c.codeImg=b}else{return false}if(g){c.bgImg=g}else{return false}c.posterText=e;c.representText=f;c.titleText=a;return $.toJSON(c)}function genGamePageJson(){var z={};var d=parsedGameArg("titleImg");if(d){z.titleImg=d}else{return false}var a=parsedGameArg("startBtnImg");if(a){z.startBtn=a}else{return false}var A=parsedGameArg("rule_tag_img");if(A){z.ruleBtn=A}else{return false}if($("input[name='hideOrganizerLogo']:checked").val()!=1){var k=parsedGameArg("organizer_logo");if(k){z.organizerLogo=k}else{return false}}if($("input[name='isOpenClick']:checked").val()!=0){var b=parsedGameArg("openClick_pic");if(b){z.openClickPic=b}else{return false}}var n=getJqSrc($$("#homeBg"));z.hbp=n;var g=getJqSrc($$("#gameBg"));z.gbp=g;var f=getPreviewWin().editPageCount||1;for(var o=0;o<f;o++){var t=o==0?"":o;if(getPreviewWin()["Edit"+t]&&getPreviewWin()["Edit"+t]["originDef"]){var C=getPreviewWin()["Edit"+t]["originDef"];var x=[];for(var v=0;v<C.length;v++){var c=C[v];var r="editTarget-"+c.name;var m=c.path;var e=false;var h={};h.name=c.name;if(c.pos||c.size||m){if(m&&typeof m[0]!=="string"){e=[];for(var l=0;l<m.length;l++){if(l===0){e.push(r)}else{e.push(r+"-"+l)}}}var B=parsedGameArg(r,e,false,c);if(!B){return false}c.pos&&(h.pos=$.parseJSON(B.pos));c.size&&(h.size=$.parseJSON(B.size));if(m){if(/^\[.+]$/.test(B.path)){var s=$.parseJSON(B.path);for(var u=0;u<s.length;u++){s[u]=[s[u]]}h.path=s}else{h.path=[B.path]}}}if(c.css){function p(j,i){var q={};q.opt=j.opt;if(i){q.opt=0}if(!q.opt){q.val=j.defVal}else{q.val=j.val}q.defVal=j.defVal;if(typeof j.tra!=="undefined"){if(!q.opt){q.tra=j.defTra}else{q.tra=j.tra}q.defTra=j.defTra}return q}h.css=[];$.each(c.crrCssArg,function(j,q){if(q.css){var D={};D.css=[];if(typeof q.opt!=="undefined"){D.opt=q.opt}$.each(q.css,function(F,E){D.css.push(p(E,D.opt===0))});h.css.push(D)}else{h.css.push(p(q))}})}x.push(h)}z["propList"+t]=$.toJSON(x)}z.shareBtn=getJqSrc($$(".fire_btn.share"));z.awardBtn=getJqSrc($$(".link_lottery"));z.fireResSuccess=getJqSrc($$(".fire_res_success"));z.fireResFail=getJqSrc($$(".fire_res_fail"));z.replayBtn=getJqSrc($$(".playagain_link"));z.subscribeBtn=getJqSrc($$(".subscribe_link"));z.detailsBtn=getJqSrc($$(".fire_success_detail"));if(templateId==22){z.check=getJqSrc($$("#checkPrizeBtn"));z.bg2=getJqSrc($$("#gameBox"));z.chang=getJqSrc($$("#faqiBox"));z.button=getJqSrc($$("#fqb_zgBtn"));z.friend=getJqSrc($$(".rb_head"));z.duan=getJqSrc($$("#zhuliBox"));z.button2=getJqSrc($$("#zlb_wyyBtn"));z.chakan=getJqSrc($$("#prizeBox"));z.my=getJqSrc($$("#pb_myBtn"));z.kuang=getJqSrc($$("#beizhengBox"));z.gui=getJqSrc($$("#bzb_gui1"));z.gui2=getJqSrc($$("#bzb_gui2"));z.lingj=getJqSrc($$("#xzb_fanhuiBtn"));z.zheng=getJqSrc($$("#xzb_jixuBtn"));z.dcr=getJqSrc($$(".sb_dcr"));z.jiantou=getJqSrc($$(".sb_jiantou"));z.xuanze=getJqSrc($$(".xzb_head"));z.wenxin=getJqSrc($$(".wxb_head"));z.back=getJqSrc($$("#wxb_fanhuiBtn"));z.jixu=getJqSrc($$("#wxb_jixuBtn"))}if(templateId==23){z.bg=getJqSrc($$("#gameBox"));z.chang=getJqSrc($$(".chang"));z.button=getJqSrc($$("#fqb_zgBtn"));z.button2=getJqSrc($$("#zlb_wyyBtn"));z.pic=getJqSrc($$(".sp_img"))}if(templateId==25){z.title=parsedGameArg("title")}if(templateId==27){z.gameTitleImg=parsedGameArg("game-title-img")}if(templateId==28){z.gameTitleImg=parsedGameArg("game-title-img");z.gameStartImg=parsedGameArg("game-start-img");z.gameRuleImg=parsedGameArg("game-rule-img");z.gameMyprizeImg=parsedGameArg("game-myprize-img")}if(templateId==30){z.gameTitleImg=parsedGameArg("game-title-img");z.gameAdImg=parsedGameArg("game-ad-img")}if(templateId==31){z.banner=getJqSrc($$("#banner_img"));z.seller_logo=getJqSrc($$("#seller_logo"));z.receiveBtn=parsedGameArg("receiveBtn");z.commandLink=parsedGameArg("commandLink")}if(templateId==37){z.bg2=getJqSrc($$(".game_div"));z.btn_2=getJqSrc($$("#rule_btn"));z.egg=getJqSrc($$(".egg"));z.egg2=getJqSrc($$(".egg2"));z.image_5=getJqSrc($$("#hammer"));z.bg3=getJqSrc($$(".win_div"));z.bg4=getJqSrc($$(".fail_div"));z.icon_3=getJqSrc($$(".again_btn"));z.icon_1=getJqSrc($$(".yqhy_btn"))}if(templateId==39){z.bg1=getJqSrc($$("#backfill_panel"));z.bg2=getJqSrc($$("#panel_help"));z.btn1=getJqSrc($$("#invite"));z.btn2=getJqSrc($$("#i_want"))}if(templateId==40){z.manImg=getJqSrc($$(".manImg"));z.panel=getJqSrc($$(".redEnvelope"))}if(!!window.addGamePageDataFn&&typeof window.addGamePageDataFn=="function"){window.addGamePageDataFn(z)}$(function(){for(var j=0;j<$("#upload_music_modal").find(".control-group").length;j++){z["bgMusic"+j]=$("#upload_music_modal").find(".control-group").eq(j).find(".music_name").text().replace(_resRoot,"*_resRoot*").replace(_qiniuResRoot,"*_qiniuResRoot*");z["bgMusicSwitch"+j]=$("#upload_music_modal").find(".control-group").find("input[name='bgMusicSwitch"+j+"']:checked").val()}})}var w=1;if(w==13){var y=parsedGameArg(false,["belleImg","shemaleImg","gameLeftBtn","gameRightBtn"]);if(!y){return}z.ph_gimgs=y.path}return $.toJSON(z)}function addEditBtn(j,h){var f=$$(".start_page,.game_page");var g=false;if(arguments.length===3){if(typeof arguments[1]==="function"){h=arguments[1];g=arguments[2]}else{f=arguments[1];h=arguments[2]}}if(arguments.length===4){f=arguments[1];h=arguments[2];g=arguments[3]}if(typeof f==="string"){f=$$(f)}if(f.length<=0){return}var i=$("<div class='moduleLayer'><div class='item'><a class='item tool' hidefocus='true' href='javascript:;'>"+j+"</a></div></div>");if(g){$("#moduleLayerBox").prepend(i)}else{$("#moduleLayerBox").append(i)}i.hide().find(".tool").on("click",h);f.on("mouseover",function(){i.show()});j=f=h=null}function getFinallyShareTxt(c,b){var a=$("input[name='useShareTxt']:checked").val();if(b=="noAwardText"){return c.replace(/玩家名称/g,"${nickName}").replace(/游戏成绩/g,"${score}").replace(/游戏排名/g,"${rank}")}else{return c.replace(/玩家名称/g,"${nickName}").replace(/游戏成绩/g,"${score}").replace(/游戏排名/g,"${rank}").replace(/奖项等级/g,"${awardName}").replace(/奖品名称/g,"${trophyName}")}}$(function(){$("#upload_img_modal .cover-recovery").live("click",function(){var m=$(this).closest(".img-area");var n=m.data("from");var l=m.data("defsrc");m.find(".thumb_img").attr("src",l);recoveryImg(n,l);$(this).hide()});$(function(){$("#disclaimer_btn").on("click",function(){$("#upload_music_modal").modal("hide");$("#disclaimer_modal").modal("show")});$("#read_over").on("change",function(){if($(this).is(":checked")){$("#music_agree_btn").removeAttr("disabled")}else{$("#music_agree_btn").attr("disabled","disabled")}});$("#music_agree_btn").on("click",function(){if($(this).attr("disabled")){return}document.cookie="disclaimer_music=true;expires="+new Date(new Date().getTime()+(30*24*60*60*1000));$("#disclaimer_modal").modal("hide");$("#upload_music_modal").modal("show")});$("#upload_music_modal").find(".music_switch").on("change",function(){if($(this).val()==0){$(this).parents(".control-group").find(".music_area").show()}else{if($(this).val()==1){$(this).parents(".control-group").find(".music_area").hide()}}});$("#upload_music_modal .music_cover-recovery").live("click",function(){var m=$(this).parents(".music_area");var n=m.data("from");var l=m.data("defsrc");m.find(".upload_music_1_1").val("");m.find(".music_name").text(l);$(this).hide()})});$("#set_exchangeLimitDetail_box .add-undefind-btn").on("click",function(){$("#set_exchangeLimitDetail_box input[name=undefindTitle]").val("");$("#set_exchangeLimitDetail_box .undefind-info-box").removeClass("hide")});$("#set_exchangeLimitDetail_box .close-btn").live("click",function(){$(this).closest(".exchange-content").remove();$("#set_exchangeLimitDetail_box .add-undefind-box").removeClass("hide")});$("#set_exchangeLimitDetail_box .ex-save").on("click",function(){var l="";var m=$.trim($("#set_exchangeLimitDetail_box input[name=undefindTitle]").val());if(!m){alert("请输入信息名！");$("#set_exchangeLimitDetail_box input[name=exchangeLimitDetail]").focus();return}l='<div class="exchange-content"><label class="checkbox inline"><span class="exchangeName">'+m+'</span></label><span class="close-btn">&times;</span></div>';$("#set_exchangeLimitDetail_box .exchangeLimitDetail-content").append(l);$("#set_exchangeLimitDetail_box .undefind-info-box").addClass("hide");if($("#set_exchangeLimitDetail_box .exchange-content").length>=2){$("#set_exchangeLimitDetail_box .add-undefind-box").addClass("hide")}});$("#set_exchangeLimitDetail_box .ex-cancel").on("click",function(){$("#set_exchangeLimitDetail_box .undefind-info-box").addClass("hide")});var g=$("#moduleLayerBox");var c=null;g.mouseenter(function(){clearTimeout(c)}).mouseleave(function(){c=setTimeout(function(){$("#moduleLayerBox .moduleLayer").hide();getPreviewWin().removeBgFrame()},10)});$("#gameContent").mouseenter(function(l){clearTimeout(c)}).mouseleave(function(l){if(getPreviewWin().ResizeDoc){getPreviewWin().ResizeDoc.find(".ui-wrapper").trigger("mouseup").trigger("mouseleave")}c=setTimeout(function(){$("#moduleLayerBox .moduleLayer").hide();getPreviewWin().removeBgFrame&&getPreviewWin().removeBgFrame()},10)});var d=$("#form_activity_config").validate({onfocusout:false,rules:{title:{required:true,maxlength:50},collect:{required:true,minlength:3,maxlength:8,collectWord:true},slogan:{required:true,maxlength:50},ruleTips:{required:true,maxlength:500},startDate:{required:true},endDate:{required:true,afterDate:true},participantVirtualAddCount:{required:true,digits:true,min:0},bless:{required:true,maxlength:30},seller_name:{required:true,maxlength:10},commandWord:{required:true,minlength:5,maxlength:30},startTime:{required:true},endTime:{required:true,afterTime:true}},messages:{title:{required:"不能为空",maxlength:"不能超过50个字符"},collect:{required:"不能为空",minlength:"不能小于3个字符",maxlength:"不能超过8个字符",collectWord:"不能输入特殊符号"},slogan:{required:"不能为空",maxlength:"不能超过50个字符"},ruleTips:{required:"不能为空",maxlength:"不能超过500个字符"},startDate:{required:"不能为空"},endDate:{required:"不能为空",afterDate:"结束时间必须大于开始时间"},participantVirtualAddCount:{required:"不能为空",digits:"必需为数值",min:"最小值为0"},bless:{required:"不能为空",maxlength:"不能超过30个字符"},commandWord:{required:"不能为空",minlength:"不能小于5个字符",maxlength:"不能超过30个字符"},seller_name:{required:"不能为空",maxlength:"不能超过10个字符"},startTime:{required:"不能为空"},endTime:{required:"不能为空",afterTime:"结束时间必须大于开始时间"}},showErrors:function(l,n){if(n&&n.length>0){$.each(n,function(o,q){var p=$(q.element);if(p.is(".cover")){alert(q.message)}p.closest(".control-group").addClass("error");p.attr("title",q.message)})}else{var m=$(this.currentElements);m.closest(".control-group").removeClass("error");m.removeAttr("title")}},submitHandler:function(){return false}});var f=10;var h=1000;var k=100;if(_isNewYyhb){f=3;h=60;k=10}if(_isYyttl){f=3}var b=$("#form_play_help").validate({onfocusout:false,rules:{initCount:{required:true,digits:true,min:1,max:100},dayIncrCount:{required:true,digits:true,min:0,max:100},dayCount:{required:true,digits:true,min:1,max:100},playCount:{required:true,digits:true,min:1,max:100},lotteryAddCount:{required:true,digits:true,min:1,max:10},unlockPrizeCount:{required:true,digits:true,min:1,max:10},awardCycleTime:{required:true,digits:true,min:5,max:1200},helpCount:{required:true,digits:true,min:3,max:30},gamePointAddPercent:{required:true,number:true,min:1,max:100},totalLotteryCount:{required:true,digits:true,min:1,max:k},dayLotteryCount:{required:true,digits:true,min:1,max:100,dayLotteryCount:true},passCondition:{required:true,number:true,min:1,max:1000000},singleUserAwards:{required:true,digits:true,min:1,max:1000000},globalAwardVirtualNum:{required:true,digits:true,min:0,max:1000000},globalProbability:{required:true,number:true,min:0,max:100},initialProbability:{required:true,number:true,min:0,max:100},helpProbability:{required:true,number:true,min:0,max:100},helpNum:{required:true,number:true,min:0,max:100},elongationMin:{required:true,digits:true,min:1,max:300,bargainTotalLength:true},elongationMax:{required:true,digits:true,elongationMax:true,min:1,max:300,bargainTotalLength:true},shortenMin:{required:true,digits:true,min:0,max:300,bargainTotalLength:true},shortenMax:{required:true,digits:true,shortenMax:true,min:0,max:300,bargainTotalLength:true},awardCycleTime2:{required:true,digits:true,min:5,max:1200},unlockPrizeCount2:{required:true,digits:true,min:1,max:10}},messages:{initCount:{required:"不能为空",digits:"必须是数字",min:"最小为1",max:"最大值为100"},dayIncrCount:{required:"不能为空",digits:"必须是数字",min:"最小为0",max:"最大值为100"},dayCount:{required:"不能为空",digits:"必须是数字",min:"最小为1",max:"最大值为100"},helpCount:{required:"不能为空",digits:"必须是数字",min:"最小为3",max:"最大值为30"},playCount:{required:"不能为空",digits:"必须是数字",min:"最小为1",max:"最大值为100"},lotteryAddCount:{required:"不能为空",digits:"必须是数字",min:"最小为1",max:"最大值为10"},unlockPrizeCount:{required:"不能为空",digits:"必须是数字",min:"最小为1",max:"最大值为10"},awardCycleTime:{required:"不能为空",digits:"必须是数字",min:"最小为5",max:"最大值为1200"},gamePointAddPercent:{required:"不能为空",number:"必须是数字",min:"最小为1",max:"最大值为100"},totalLotteryCount:{required:"不能为空",digits:"必须是数字",min:"最小为1",max:"最大值为100"},dayLotteryCount:{required:"不能为空",digits:"必须是数字",min:"最小为1",max:"最大值为100"},passCondition:{required:"不能为空",number:"必须是数字",min:"最小为1",max:"最大值为1000000"},singleUserAwards:{required:"不能为空",digits:"必须是数字",min:"最小为1",max:"最大值为1000000"},globalAwardVirtualNum:{required:"不能为空",digits:"必须是数字",min:"最小为0",max:"最大值为1000000"},globalProbability:{required:"不能为空",number:"必需为数值",min:"数值至少为0",max:"数值最大为100"},initialProbability:{required:"不能为空",number:"必需为数值",min:"数值至少为0",max:"数值最大为100"},helpProbability:{required:"不能为空",number:"必需为数值",min:"数值至少为0",max:"数值最大为100"},helpNum:{required:"不能为空",number:"必需为数值",min:"数值至少为0",max:"数值最大为100"},elongationMin:{required:"不能为空",digits:"必需为数值",min:"数值至少为1",max:"数值最大为300"},elongationMax:{required:"不能为空",digits:"必需为数值",min:"数值至少为1",max:"数值最大为300"},shortenMin:{required:"不能为空",digits:"必需为数值",min:"数值至少为0",max:"数值最大为300"},shortenMax:{required:"不能为空",digits:"必需为数值",min:"数值至少为0",max:"数值最大为300"},awardCycleTime2:{required:"不能为空",digits:"必须是数字",min:"最小为5",max:"最大值为1200"},unlockPrizeCount2:{required:"不能为空",digits:"必须是数字",min:"最小为1",max:"最大值为10"}},showErrors:function(l,n){if(n&&n.length>0){$.each(n,function(o,q){var p=$(q.element);if(p.is(".cover")){alert(q.message)}p.closest(".control-group").addClass("error");p.attr("title",q.message)})}else{var m=$(this.currentElements);m.closest(".control-group").removeClass("error");m.removeAttr("title")}},submitHandler:function(){return false}});var e=$("#form_high_setting").validate({onfocusout:false,rules:{wxname:{required:true,maxlength:30},wxlink:{required:true,maxlength:500},organizerLink:{maxlength:500},openingLink:{maxlength:500},organizer:{maxlength:16},organizerLogo:{required:true},openClickPic:{required:true},gameTime:{required:true,digits:true,min:f,max:h},shareQrcodeBg:{required:true},shareIco:{required:true},checkShareTxt:{shareTxt:true},customCopyrightPic:{required:true},newPzhb1:{required:true,minlength:4,maxlength:8,hanziLimit:true},newPzhb2:{pzLengthLimit:true,hanziLimit:true},newPzhb3:{pzLengthLimit:true,hanziLimit:true}},messages:{wxname:{required:"不能为空",maxlength:"长度不能大于30"},wxlink:{required:"不能为空",maxlength:"长度不能大于500"},organizerLink:{maxlength:"长度不能大于500"},openingLink:{maxlength:"长度不能大于500"},organizer:{maxlength:"长度不能大于16"},organizerLogo:{required:"企业logo不能为空"},openClickPic:{required:"加载页面开启可点击提示图片不能为空"},gameTime:{required:"不能为空",digits:"必须是数字",min:"最小为"+f,max:"最大值为"+h},shareQrcodeBg:{required:"不能为空"},shareIco:{required:"不能为空"},checkShareTxt:{shareTxt:"自定义微信分享内容错误"},customCopyrightPic:{required:"不能为空"},newPzhb1:{required:"不能为空",minlength:"最少四个字",maxlength:"不能超过八个字",hanziLimit:"请输入汉字"},newPzhb2:{pzLengthLimit:"每句由4-8个汉字组成",hanziLimit:"请输入汉字"},newPzhb3:{pzLengthLimit:"每句由4-8个汉字组成",hanziLimit:"请输入汉字"}},showErrors:function(l,n){if(n&&n.length>0){$.each(n,function(o,q){var p=$(q.element);if(p.is(".cover")){alert(q.message)}p.closest(".control-group").addClass("error");p.attr("title",q.message)})}else{var m=$(this.currentElements);m.closest(".control-group").removeClass("error");m.removeAttr("title")}},submitHandler:function(){return false}});var j=function(l){$.ajax({url:"/admin/new_activity/getActivityLink",timeout:15000,dataType:"json",data:{activityId:l},success:function(n){if(n.ret==0){var m=n.model;$("input[name='act_link']").val(m.act_link);$("#qrcode").attr("src",m.qrcode_url);$("#qrcode_url").attr("href",m.qrcode_url)}}})};$(".checkBorder").live("mouseover",function(){var l=$(this);setTimeout(function(){l.removeClass("checkBorder")},10)});$.validator.addMethod("collectWord",function(n){var o=/^(([^\^\.<>%&',;=?$"':#@!~\]\[{}\\/`\|])*)$/;var m=/[\uff00-\uffff]/g;var l=o.test(n)&&!m.test(n);return l},"不能包含特殊字符");$.validator.addMethod("afterDate",function(n){alert(m);var m=$("input[name='startDate']");var l=$("input[name='endDate']");m.datetimepicker("setDate",m.val());l.datetimepicker("setDate",l.val());return l.datetimepicker("getDate")>m.datetimepicker("getDate")},"结束时间必须大于开始时间");$.validator.addMethod("dayLotteryCount",function(n){var o=$("input[name='totalLotteryCount']");if(o.attr("disabled")){return true}else{var m=Number(n);var l=Number(o.val());return l>=m}},"总抽奖机会必须大于或者等于每日抽奖机会");$.validator.addMethod("elongationMax",function(n,m,p){var l=Number(n);var o=Number($(m).parent().find("input[name='elongationMin']").val());return l>o},"单次拿奖伸长距离范围最大值取值必需大于最小值");$.validator.addMethod("shortenMax",function(n,m,p){var l=Number(n);var o=Number($(m).parent().find("input[name='shortenMin']").val());return l>=o},"单次拿奖缩短距离范围最大值取值必需大于等于最小值");$.validator.addMethod("bargainTotalLength",function(n,l,o){var m=Number(n);var p=$("input[name='totalLength']").val();return p>m},"单次拿奖伸长/缩短的距离不能大于总距离");$.validator.addMethod("hanziLimit",function(l){if(l.length==0){return true}var n=/^[0-9\u4e00-\u9faf]+$/;var m=n.test(l);if(m){return true}else{return false}},"请输入汉字");$.validator.addMethod("pzLengthLimit",function(m){var l=m.length;if(l==0||(l>=4&&l<=8)){return true}return false},"每句由4-8个汉字组成");$.validator.addMethod("afterTime",function(n){var m=$("input[name='startTime']");var l=$("input[name='endTime']");return i(m.val(),l.val())},"结束时间必须大于开始时间,打卡时间段仅支持15分钟内");function i(n,q){var v=n.split(":"),r=q.split(":"),o=new Date(),u=o.getFullYear(),p=o.getMonth(),t=o.getDate();var n=new Date(u,p,t,v[0],v[1]).getTime();var q=new Date(u,p,t,r[0],r[1]).getTime();var l=Math.ceil((q-n)/1000/60);if(l<5||l>15){return false}else{return true}}$.validator.addMethod("shareTxt",function(m,l,n){return $(l).val()==1},"微信分享内容错误");$.validator.addMethod("addressLimit",function(l){if($("#needLimitAddress").is(":checked")){if($("#addr_prov").val()==""){return false}}return true},"请选择省份");$("#needLimitAddress").on("click",function(){if($("#needLimitAddress").is(":checked")){$("#addressGroup").show()}else{$("#addressGroup").hide()}});$("input[name='showDanmu']").on("change",function(){if($("input[name='showDanmu']:checked").val()==1){getPreviewWin().game.clearDanmu()}else{getPreviewWin().game.showDanmu(true)}});$("#withHelp").on("click",function(){if($("#withHelp").is(":checked")){$("#gamePointAddPercent").removeAttr("disabled");$(".helpType_1_cont, .helpType_2_cont").find("input").removeAttr("disabled")}else{$("#gamePointAddPercent").attr("disabled","disabled");$(".helpType_1_cont, .helpType_2_cont").find("input").attr("disabled","disabled")}});$(".award_tab_content").on("click",".probabilityType",function(){var l=$(this).closest(".award_tab");if($(this).data("value")==1){}else{}});$("input[name='probabilityMode']").on("change",function(){if($("input[name='probabilityMode']:checked").val()==1){$("#set_probabilityMode_box .controls:eq(1),#set_probabilityMode_box .probabilityInfo").show();$("input[name='globalProbability']").removeAttr("disabled");$(".probabilityMode-help-inline").show();$(".award_tab input[name='probabilityValue']").attr("disabled","disabled").closest(".control-group").hide();cancelProbabilityType()}else{if($("input[name='probabilityMode']:checked").val()==2){$("#set_probabilityMode_box .controls:eq(1),#set_probabilityMode_box .probabilityInfo").hide();$("input[name='globalProbability']").attr("disabled","disabled");$(".probabilityMode-help-inline").hide();$(".award_tab input[name='probabilityValue']").removeAttr("disabled").closest(".control-group").show();cancelProbabilityType()}}});$("input[name='probabilityMode']").on("click",function(){$("input[name='probabilityMode']").removeClass("selected");$(this).addClass("selected");$("#probabilityMode_alert_check").attr("checked",false);$(".probabilityMode-alert-confirm").addClass("disabled");$("#probabilityMode-alert-modal").modal("show");return false});$("#probabilityType").on("change",function(){$("input[name='globalProbability']").attr("disabled","disabled");$("#set_probabilityMode_box").css("color","grey");$("#set_probabilityType_box").css("color","#000");$("#set_probabilityMode_box input[type=radio]").attr("checked",false);ShowProbabilityInfo()});$("#probabilityType").on("click",function(){$("#probabilityType_alert_check").attr("checked",false);$(".probabilityType-alert-confirm").addClass("disabled");$("#probabilityType-alert-modal").modal("show");return false});$("#probabilityMode-alert-modal input[name='probabilityMode_alert_check']").change(function(){var l=$(this).closest("#probabilityMode-alert-modal");if($(this).is(":checked")){$(".probabilityMode-alert-confirm",l).removeClass("disabled")}else{$(".probabilityMode-alert-confirm",l).addClass("disabled")}});$("#probabilityType-alert-modal input[name='probabilityType_alert_check']").change(function(){var l=$(this).closest("#probabilityType-alert-modal");if($(this).is(":checked")){$(".probabilityType-alert-confirm",l).removeClass("disabled")}else{$(".probabilityType-alert-confirm",l).addClass("disabled")}});$("#probabilityMode-alert-modal .probabilityMode-alert-confirm").click(function(){if($(this).hasClass("disabled")){return}$("#probabilityMode-alert-modal").modal("hide");var l=$("input[name='probabilityMode']");l.each(function(){if($(this).hasClass("selected")){$(this).attr("checked","checked").trigger("change",true)}})});$("#probabilityType-alert-modal .probabilityType-alert-confirm").click(function(){if($(this).hasClass("disabled")){return}$("#probabilityType-alert-modal").modal("hide");$("input[name='probabilityType']").attr("checked","checked").trigger("change",true)});$(".award_tab_content").on("input","input[name='defaultWinnerAmount']",function(){var o=$(this);var l=o.closest(".controls");if(isNaN(o.val())){return}var n=Number(o.closest(".award_detail_form").find("input[name='awardRealNum']").val());var m=Number(o.val());if((n-m)<0){l.find(".defaultWinnerAmount-tips-error").show();l.find(".defaultWinnerAmount-tips").hide()}else{l.find(".defaultWinnerAmount-tips-error").hide();l.find(".defaultWinnerAmount-tips").show()}l.find(".c1").text(m);l.find(".c2").text(n-m)});$("#add_sncode_award_modal").on("input","input[name='award_unsend_num']",function(){var o=$(this);var l=o.closest(".controls");if(isNaN(o.val())){return}var n=Number(o.closest(".award_detail_form").find("input[name='awardRealNum']").val());var m=Number(o.val())});$(".config-tab-content").on("change","input[name='defaultWinner']",function(){var m=$(this).closest(".award_detail_form").find(".set_defaultWinnerAmount_box");var o=m.closest(".award_detail_form").data("awardid");var l=m.find("img.qrcode_img");if($(this).val()==1){m.hide().find("input").attr("disabled","disabled")}else{m.show();if(!_hasPublish){m.find("input").removeAttr("disabled")}if(m.find(".verifycode").text()==""){m.find(".verifycode").text(genRandomNum(6))}m.find("input[name='defaultWinnerAmount']").trigger("input");if(!l.attr("src")){var n=window.www_domain+"/mobile/newgame/default_winner.jsp";if(isEdit){n+="?activityid="+window.activityJson.id;n+="&aid="+window.activityJson.aidEncrypt;n+="&wuid="+window.activityJson.wuid;n+="&awardId="+o}$.ajax({url:"/admin/new_activity/generate_qrcode",timeout:15000,dataType:"json",data:{theUrl:encodeURI(n)},success:function(p){if(p.ret==0){l.attr("src",p.model.qrcodeUrl);m.find(".qrcode_down_link").attr("href",p.model.qrcodeUrl)}}})}}});$(".add_defaultwinner_award").live("click",function(){var p=$(this).attr("data-awardid");var m=$(this).attr("data-trophyid");var n=$(this).parent();var l=$(this).closest(".award_detail_form");var o=$("#add_defaultwinner_award_modal");o.modal("show");o.attr("data-awardid",p).attr("data-trophyid",m);$("input[name='defaultwinner_send_num']",o).val(n.find("input[name='defaultWinnerLoseNum']").val());$("input[name='defaultwinner_available_num']",o).val(l.find("input[name='awardRealNum']").val());$("input[name='defaultwinner_left_num']",o).val(n.find("input[name='defaultWinnerAmount']").val());$("input[name='defaultwinner_left_num']",o).parent().find(".c1").text(l.find("input[name='awardRealNum']").val())});var a=$("#form_add_defaultwinner_award_setting").validate({onfocusout:false,rules:{defaultwinner_left_num:{required:true,number:true,min:0,defaultWinnerLeftNum:true},},messages:{defaultwinner_left_num:{required:"不能为空",number:"必需为数值",min:"数值至少为0",defaultWinnerLeftNum:"待领取数量不能大于可内定数量"},},showErrors:function(l,n){if(n&&n.length>0){$.each(n,function(o,q){var p=$(q.element);if(p.is(".cover")){alert(q.message)}p.closest(".control-group").addClass("error");p.attr("title",q.message)})}else{var m=$(this.currentElements);m.closest(".control-group").removeClass("error");m.removeAttr("title")}},submitHandler:function(){var q=$("#add_defaultwinner_award_modal");var r=q.attr("data-awardid");var m=q.attr("data-trophyid");var o=$("#add_defaultwinner_award_confirm");var l=$("#form_add_defaultwinner_award_setting");if(o.hasClass("disabled")){return}var p=parseInt($('input[name="defaultwinner_left_num"]',l).val())+parseInt($('input[name="defaultwinner_send_num"]',l).val());var n={activityId:global_aid,awardId:r,trophyId:m,updateNum:p};o.addClass("disabled");$.ajax({url:"/admin/new_activity/update_switch",timeout:15000,type:"post",dataType:"json",data:n,success:function(t){if(t.ret==0){var s=t.model;unbindBeforeUnload();alert("内定奖品数量修改成功");window.location.reload()}else{alert(t.msg)}o.removeClass("disabled")},error:function(s,u,t){alert("服务器正在紧张的运行中，请稍后再试");o.removeClass("disabled")}})}});$(".get_default_winner_pwd").live("click",function(){if($(this).attr("data-disabled")){return}var n=$(this).data("awardid");var l=$(this).data("trophyid");var m=$("#defaultwinner_pwd_modal").attr("data-awardid",n).attr("data-trophyid",l);m.modal("show").find("select[name='defaultwinner_pwd_statu']").trigger("change");m.find("#export_defaultwinner_pwd").attr("href","/admin/new_activity/export_switchcode?activityId="+global_aid+"&trophyId="+l+"&type=2")});$(document).on("click",".huifuBtn",function(){var m=$(this).parents(".cover-area").find("input[name='fileupload']").attr("data-defaulturl");$(this).parents(".cover-area").find(".thumb_img").attr("src",m);$(this).parents(".cover-area").find(".fileupload_input").val(m);$(this).hide();var l=$(this).parents(".cover-area").find(".fileupload_input").attr("data-target");console.log($(m));$$(l).css("backgroundImage","url("+m+")")});$("#defaultwinner_pwd_modal select[name='defaultwinner_pwd_statu']").on("change",function(){var n=$("#defaultwinner_pwd_modal");var p=n.attr("data-awardid");var l=n.attr("data-trophyid");var o=$(this).val();var m={activityId:global_aid,trophyId:l,type:o,};$(".mp_loading_cover").show();$(".mp_loading_clip").show();$.post("/admin/new_activity/query_switch_awardcode",m,function(s){$(".mp_loading_cover").hide();$(".mp_loading_clip").hide();if(s.ret==0){var r=$("#defaultwinner_pwd_modal .defaultwinner_pwd_cont").html("");if(s.model.records){for(var q=0;q<s.model.records.length;q++){r.append('<div class="control-group"><label class="control-label">内定密码'+q+'：</label><div class="controls">'+s.model.records[q]+"</div></div>")}}}else{alert(s.msg)}})});$("#set_probabilityMode_box label").on("click",function(){var l=$(this).find(".field_tips_info");if(l.is(":hidden")){l.show();setTimeout(function(){l.hide()},3000)}});$(".prize_config_tab_link").on("click",function(){$(".prize_config_tab").click()});$("input[name='trophyValidator']").on("click",function(l){if($(this).val()==2){$("#trophyValidator-alert-modal").modal("show");l.stopPropagation();return false}});$("#trophyValidator-alert-modal .trophyValidator-alert-confirm").click(function(){if($(this).hasClass("disabled")){return}$("#trophyValidator-alert-modal").modal("hide");$("input[name='trophyValidator'][value='2']").attr("checked","checked").trigger("change",true)});$("#trophyValidator_alert_check").change(function(){if($(this).is(":checked")){$("#trophyValidator-alert-modal .trophyValidator-alert-confirm").removeClass("disabled")}else{$("#trophyValidator-alert-modal .trophyValidator-alert-confirm").addClass("disabled")}});$("input[name='blacklist']").on("click",function(l){if($(this).val()==0){$("#blacklist-alert-modal").modal("show");l.stopPropagation();return false}});$("#blacklist-alert-modal .blacklist-alert-confirm").click(function(){if($(this).hasClass("disabled")){return}$("#blacklist-alert-modal").modal("hide");$("input[name='blacklist'][value='0']").attr("checked","checked").trigger("change",true)});$("#blacklist_alert_check").change(function(){if($(this).is(":checked")){$("#blacklist-alert-modal .blacklist-alert-confirm").removeClass("disabled")}else{$("#blacklist-alert-modal .blacklist-alert-confirm").addClass("disabled")}});$(".config-tab-content").on("click",".probabilityMode_highlight_link",function(){addFieldCheckBorder("probabilityMode")});$("#save_btn").on("click",function(){var w=$(this);if(w.hasClass("disabled")){return}var A=true;w.addClass("disabled");if(_isKlhb){if(!_hasBindWx){alert("温馨提示：创建口令红包的商家公众号必须是通过微信认证的公众号，否则活动将不能正常进行！");return false}if(!_verifyAvailable){alert("温馨提示：创建口令红包，认证公众号必须进行服务授权，否则将会导致活动无法正常进行！授权服务后即可创建活动。");return false}}$(".config_view:visible form").each(function(Z,aa){var Y=$(aa);if(Y.is(".award_detail_form")){var Z=$(aa).parent().index();if($(".award_tab_item .prize_tab_item").eq(Z).is(":hidden")){return true}}if(!Y.validate().form()){A=false;return true}});if($("#award_convert_limit_form").length>0){var z=$("#award_convert_limit").find(".convert_limit input").not(":disabled");var J=true;var s=[];z.each(function(){if(!$(this).val()){J=false}else{s.push($(this).val())}});if(!J){alert("请先填写“得奖所需助力人数”！");w.removeClass("disabled");return false}if(s.length>1){for(var S=0;S<s.length;S++){if(parseInt(s[S])<parseInt(s[S+1])){alert("奖项所需助力人数要按奖项一至奖项八从大到小排序！");w.removeClass("disabled");return false}}}if(s.length>1){s.sort();for(var U=0;U<s.length;U++){if(s[U]===s[U+1]){alert("各奖项的“得奖所需助力人数”不能相等！");w.removeClass("disabled");return false}}}}if(!A){alert("校验不通过："+$(".error .control-label").text().replace("：",""));w.removeClass("disabled");return false}var t=$("#form_activity_config");var x=$("#form_play_help");var P=$("#form_high_setting");var N=x.find("input[name='awardSendType']:checked").val();var R=x.find("#dayLotteryCount").val();var m=false;if($("#set_exchangeLimitDetail_box .exchange-content").length>0){m=true}var X={"activity.activityType":31502,"activity.skinId":window.skinId,"activity.end":t.find("#endDate").val(),"activity.start":t.find("#startDate").val(),"activity.ruleTips":t.find("#ruleTips").val(),"activity.title":t.find("#title").val(),"activity.organizer":P.find("#organizer").val(),"activity.awardSendType":N,"activity.organizerLink":P.find("#organizerLink").val(),"activity.showSupport":P.find("input[name='showCopyright']:checked").val()==1,"activity.showCopyright":P.find("input[name='showCopyright']:checked").val()==1,"activity.useDefaultCopyright":P.find("input[name='useDefaultCopyright']:checked").val()==1,"activity.customCopyrightPic":P.find("#customCopyrightPic").val(),"activity.hideOrganizerLogo":P.find("input[name='hideOrganizerLogo']:checked").val()==1,"activity.organizerLogo":P.find("#organizerLogo").val(),"activity.extraData":Number(P.find("input[name='shareType']:checked").val())+Number(P.find("input[name='blacklist']:checked").val())+Number(P.find("input[name='open_opening_link']:checked").val())+Number(x.find("input[name='helpEffect']:checked").val())+(P.find("input[name='exchangeLimitDetail'][value='4']").is(":checked")?4:0)+(P.find("input[name='exchangeLimitDetail'][value='2']").is(":checked")?2:0)+(m?Math.pow(2,14):0)+Number($("input[name=helpEffectMs]:checked").val()),"activity.shareQrcodeBg":P.find("#shareQrcodeBg").val(),"activity.useDefaultQrcodeBg":P.find("input[name='useDefaultQrcodeBg']:checked").val()==1,"activity.bgPic":getJqSrc($$("#gameBg"),true),"imgTextShare.sttr1":P.find("input[name='useShareIco']:checked").val()==1?0:1,"imgTextShare.imgPath":P.find("#shareIco").val(),"imgTextShare.id":P.find("#adv_subtab_2").attr("shareId")||"","imgTextShare.sttr2":P.find("input[name='useShareTxt']:checked").val()==1?0:1,"imgTextShare.noAwardText":getFinallyShareTxt(P.find("#share_txt_controls .j-share-txt-content").eq(0).text(),"noAwardText"),"imgTextShare.awardText":getFinallyShareTxt(P.find("#share_txt_controls .j-share-txt-content").eq(1).text(),"awardText"),"imgTextShare.sttr3":P.find("input[name='useShareTitle']:checked").val()==1?0:1,"imgTextShare.titleText":P.find("#j-share-title-content").eq(0).text().replace(/玩家名称/g,"${nickName}"),"activity.globalProbability":x.find("#globalProbability").val(),"activity.probabilityType":x.find("#probabilityType").is(":checked")?1:2,"activity.hideParticipant":t.find("input[name='hideParticipant']:checked").val()==1,"activity.participantVirtualAddCount":t.find("#participantVirtualAddCount").val(),"activity.wxname":P.find("#wxname").val(),"activity.wxlink":P.find("#wxlink").val(),"activity.trophyValidator":P.find("input[name='trophyValidator']:checked").val()==1,"activity.unionId":global_uid,"activity.pageTemplateId":pageTemplateId,"activity.path":window.actGamePagePath,"activity.withHelp":x.find("#withHelp").is(":checked")?true:false,"activity.privilegeType":isTest?2:1,"activity.securityLevel":P.find("input[name='securityLevel']:checked").val(),"playRule.dayCount":x.find("#dayCount").val(),"playRule.dayIncrCount":x.find("#dayIncrCount").val(),"playRule.initCount":x.find("#initCount").val(),"playRule.playCount":x.find("#playCount").val(),"playRule.totalLotteryCount":x.find("#totalLotteryCount").val(),"playRule.limitLottery":x.find("input[name='totalLotteryCountRadio']:checked").val()==2,"playRule.dayLotteryCount":R,"playRule.gameTimeType":P.find("input[name='gameTimeRadio']:checked").val(),"playRule.gameTime":P.find("#gameTime").val(),"playRule.participateLimit":P.find("input[name='participateLimit']:checked").val()==1,"playRule.needFollow":P.find("input[name='forceAttent']:checked").val()==1,"playRule.exchangeLimit":P.find("input[name='exchangeLimit']:checked").val()==1,"playRule.needArea":false,"helpRule.helpType":$("#helpType").val(),"helpRule.maxCount":$("#maxCount").val(),"helpRule.minCount":$("#minCount").val(),"helpRule.percentage":$("#percentage").val(),"helpRule.helpCount":$("#helpCount").val(),"helpRule.exchangeCount":$("#exchangeCount").val(),"helpRule.lotteryAddCount":$("#lotteryAddCount").val(),"helpRule.gamepointAddPercent":$("#gamePointAddPercent").val(),_:new Date().getTime()};if(_isNewBargain){X["activity.bgPic"]=getJqSrc($$("#bargainBannerBg"),true)}if(_isFromHb){X["activity.extraData"]=X["activity.extraData"]+512}if(x.find("input[name='probabilityMode']:checked").val()==2){X["activity.extraData"]=X["activity.extraData"]+Math.pow(2,10)}if(t.find("input[name='showDanmu']:checked").val()==2){X["activity.extraData"]=X["activity.extraData"]+Math.pow(2,11)}if(P.find("input[name='securityType']:checked").val()==1){X["activity.extraData"]=X["activity.extraData"]+Math.pow(2,13)}var T={};T.awardCycleTime=$("#awardCycleTime").val();T.unlockPrizeCount=$("#unlockPrizeCount").val();T.loadingPic=$$("#loading_banner_bg").css("backgroundImage");T.loadingLogo=$$("#yy_logo_bg").css("backgroundImage");T.lotteryPic=$$("#lotto_banner_bg").css("backgroundImage");T.lotteryLogo=$$("#lotto_logo_bg").css("backgroundImage");T.loadingLink=$("#openingLink").val();T.isOpenClick=$("input[name='isOpenClick']:checked").val()==0?false:true;T.openClickPic=$("#openClickPic").val();T.copyrightLink=$("#copyrightLink").val();T.globalAwardVirtualNum=$("#set_globalAwardVirtualNum_box #globalAwardVirtualNum").val();if(m){var n="";var B=$("#set_exchangeLimitDetail_box .exchange-content");for(var U=0;U<B.length;U++){if(n){n+=","}n+=B.eq(U).find(".exchangeName").text()}T.checkAwardExtend=n}T.jumpLinkBtn=P.find("input[name='jumpLinkBtn']:checked").val();if($("#collect").size()>0){T.collect=$("#collect").val()}if($("#slogan").size()>0){T.slogan=$("#slogan").val()}if(_isJiWuFu){var M=$("#form_jiwufu_gametext_setting");if($("input[name='jiwufu_slogan_radio']:checked",M).val()==1){T.slogan=""}else{T.slogan="";$("#cus_jiwufu_text_cont input").each(function(Y,Z){var aa=$(Z);if(aa.val()==""){T.slogan="";return false}if(Y!=0){T.slogan+="::"}T.slogan+=aa.val()})}}if(templateId==14){var M=$("#form_jiwufu_gametext_setting");if($("input[name='jiwufu_slogan_radio']:checked",M).val()==1){T.slogan=""}else{T.slogan="";$("#cus_jiwufu_text_cont input").each(function(Y,Z){var aa=$(Z);if(aa.val()==""){T.slogan="";return false}if(Y!=0){T.slogan+="::"}T.slogan+=aa.val()})}}if(_isNewShakeRedpack){var G=$("#form_newshakeredpack_redpacktext_setting");T.redpackText="";$("#cus_newshakeredpack_redpacktext_cont input").each(function(Y,Z){var aa=$(Z);if(aa.val()==""){T.redpackText="";return false}if(Y!=0){T.redpackText+="::"}T.redpackText+=aa.val()})}if(_isNewPzhb){T.newPzhb1=$("#newPzhb1").val();T.newPzhb2=$("#newPzhb2").val();T.newPzhb3=$("#newPzhb3").val()}if(_isNewBargain){T.totalLength=$("input[name='totalLength']",x).val();T.elongationMin=$("input[name='elongationMin']",x).val();T.elongationMax=$("input[name='elongationMax']",x).val();T.shortenMin=$("input[name='shortenMin']",x).val();T.shortenMax=$("input[name='shortenMax']",x).val()}if(_isKlhb){T.bless=$("input[name='bless']").val();T.seller_name=$("input[name='seller_name']").val()}if(_isNewYyhb){T.commandWord=$("#commandWord").val()}if(_isAbsolutelyBigWheel){T.initialProbability=$("#initialProbability").val();T.helpNum=$("#helpNum").val()}if(_isYyttl){var r=$("#award_detail_form_0");var q=$("#award_detail_form_0").find("input[name='withdrawThresholdRadio']:checked").val();var E=r.find(".withdrawThreshold_Max").val();if(q==1||q==3){T.withdrawThresholdMin=parseFloat(q)*1000*100/1000}else{q=r.find(".withdrawThreshold_Min").val();T.withdrawThresholdMin=parseFloat(q)*1000*100/1000}T.withdrawThresholdMax=parseFloat(E)*1000*100/1000}if(_isZcqc){var o=$("#startTime").val();var u=$("#endTime").val();var p=$("#startDate").val();var y=$("#endDate").val();T.startTime=o;T.endTime=u;T.startDate=p;T.endDate=y}if(_isPanoredpack){if(+$("input[name=helpEffectMs]:checked").val()!=0){T.awardCycleTime=$("#awardCycleTime2").val();T.unlockPrizeCount=$("#unlockPrizeCount2").val()}}if(_isValuationHunter){var H={};var V=$("#valuationHunter_goodsImg_modal").find("li");var Q=V.length-1;var v=$(".hunter_li_hide").length;for(var U=0;U<(Q-v);U++){H[(U+1)+"_size"]=V.eq(U).find(".hunter_minNum").val()+"-"+V.eq(U).find(".hunter_maxNum").val();H[(U+1)+"_path"]=V.eq(U).find(".hunter_img").attr("src")}H.size=Q-v;T.hunter=H}if(_isTruthOrDare){if(!window.TruthQuestion){alert("请填写完成题目！");return false}T.TruthQuestion=JSON.stringify(window.TruthQuestion)}if(_isWanSheng){if(!window.TruthQuestion){alert("请填写完成分享内容！");return false}T.TruthQuestion=JSON.stringify(window.TruthQuestion)}if(N==1){X["rankingSendRule.rankingType"]=2;X["rankingSendRule.withType"]=0;X["rankingSendRule.orderBy"]=0;X["rankingSendRule.rankingLine"]=0}else{if(N==2){X["challengeSendRule.passCondition"]=$("#passCondition").val();X["challengeSendRule.singleUserAwards"]=$("#singleUserAwards").val()}}var W=$(".award_tab_item>li.prize_tab_item").length;var l=0;var C=[];for(var U=0;U<W;U++){var L=$(".award_tab_item>li.prize_tab_item").eq(U);X["awardBindPrizes["+U+"].award.awardLevel"]=U+1;X["awardBindPrizes["+U+"].award.awardType"]=$(".award_tab_"+U+" select[name='awardType']").val();X["awardBindPrizes["+U+"].award.awardName"]=$(".award_tab_"+U+" input[name='awardName']").val();X["awardBindPrizes["+U+"].award.awardPic"]=$(".award_tab_"+U+" input[name='prize_image']").val();X["awardBindPrizes["+U+"].trophy.awardPic"]=$(".award_tab_"+U+" input[name='prize_image']").val();X["awardBindPrizes["+U+"].award.probabilityType"]=$(".award_tab_"+U+" input[name='probabilityType"+U+"']:checked").data("value");X["awardBindPrizes["+U+"].award.probabilityValue"]=$(".award_tab_"+U+" input[name='probabilityValue']").val();X["awardBindPrizes["+U+"].award.awardIndex"]=U+1;X["awardBindPrizes["+U+"].award.operationTip"]=$(".award_tab_"+U+" input[name='operationTip']").val();X["awardBindPrizes["+U+"].award.storeAddress"]=$(".award_tab_"+U+" input[name='storeAddress']").val();X["awardBindPrizes["+U+"].award.subhead"]=$(".award_tab_"+U+" input[name='subhead']").val();X["awardBindPrizes["+U+"].award.serviceTel"]=$(".award_tab_"+U+" input[name='serviceTel']").val();X["awardBindPrizes["+U+"].award.description"]=$(".award_tab_"+U+" textarea[name='description']").val();if($("#award_convert_limit_form").length>0){X["awardBindPrizes["+U+"].award.integralConvert"]=$("#award_convert_limit_form").find("input[name='integralConvert"+U+"']").val()}if(L.hasClass("hide")){X["awardBindPrizes["+U+"].award.deleted"]=true;X["awardBindPrizes["+U+"].trophy.deleted"]=true}else{X["awardBindPrizes["+U+"].award.deleted"]=false;X["awardBindPrizes["+U+"].trophy.deleted"]=false;C.push({awardName:$(".award_tab_"+U+" input[name='awardName']").val(),trophyName:$(".award_tab_"+U+" input[name='trophyName']").val()});l+=parseInt($(".award_tab_"+U+" input[name='awardRealNum']").val())}X["awardBindPrizes["+U+"].trophy.awardRealNum"]=parseInt($(".award_tab_"+U+" input[name='awardRealNum']").val())+parseInt($(".award_tab_"+U+" input[name='awardLoseNum']").val());X["awardBindPrizes["+U+"].trophy.trophyName"]=$(".award_tab_"+U+" input[name='trophyName']").val();X["awardBindPrizes["+U+"].trophy.awardVirtualNum"]=$(".award_tab_"+U+" input[name='awardVirtualNum']").val();if(!_isYyttl){X["awardBindPrizes["+U+"].trophy.singleMin"]=parseFloat($(".award_tab_"+U+" input[name='singleMin']").val())*1000*100/1000;X["awardBindPrizes["+U+"].trophy.singleMax"]=parseFloat($(".award_tab_"+U+" input[name='singleMax']").val())*1000*100/1000}else{X["awardBindPrizes["+U+"].trophy.singleMin"]=100;X["awardBindPrizes["+U+"].trophy.singleMax"]=100}X["awardBindPrizes["+U+"].trophy.totalCount"]=parseInt(parseFloat($(".award_tab_"+U+" input[name='totalCount']").val())*1000*100/1000);X["awardBindPrizes["+U+"].trophy.awardType"]=$(".award_tab_"+U+" select[name='awardType']").val();X["awardBindPrizes["+U+"].trophy.validityStart"]=$(".award_tab_"+U+" input[name='validityStart']").val();X["awardBindPrizes["+U+"].trophy.validityStop"]=$(".award_tab_"+U+" input[name='validityStop']").val();X["awardBindPrizes["+U+"].trophy.snGenerateType"]=$(".award_tab_"+U+" input[name='sncodeType']:checked").val();X["awardBindPrizes["+U+"].trophy.defaultSnCode"]=$(".award_tab_"+U+" textarea[name='sncodes']").val().split(/\n/g).toString();X["awardBindPrizes["+U+"].trophy.isWxCard"]=$(".award_tab_"+U+" input[name='isWxCard']:checked").val()==1;var K=0;var F={};if($(".award_tab_"+U+" input[name='defaultWinner']:checked").val()==1){F.setSwitchNum=0}else{F.setSwitchNum=$(".award_tab_"+U+" input[name='defaultWinnerAmount']").val();K+=1}X["awardBindPrizes["+U+"].award.logicSwitch"]=K;if($(".award_tab_"+U+" input[name='guanwanJumpBtn']:checked").val()==1){F.guanwanJumpBtn="false"}else{if($(".award_tab_"+U+" input[name='guanwanJumpBtn']:checked").val()==2){F.guanwanJumpBtn="true";F.jumpBtnName=$(".award_tab_"+U+" input[name='jumpBtnName']").val();F.jumpLink=$(".award_tab_"+U+" input[name='jumpLink']").val()}}if(_isNewBargain&&U==0){F.detailLink=$(".award_tab_"+U+" input[name='detailLink']").val();T.virtualNum=$(".award_tab_"+U+" input[name='virtualNum']").val()}X["awardBindPrizes["+U+"].award.custom"]=$.toJSON(F);if(isEdit){X["awardBindPrizes["+U+"].award.activityId"]=global_aid;X["awardBindPrizes["+U+"].trophy.activityId"]=global_aid;X["awardBindPrizes["+U+"].award.id"]=$(".award_tab_"+U+" input[name='awardId']").val();X["awardBindPrizes["+U+"].trophy.id"]=$(".award_tab_"+U+" input[name='trophyId']").val();X["awardBindPrizes["+U+"].trophy.awardsTypeId"]=$(".award_tab_"+U+" input[name='awardId']").val()}}X["activity.extendOperation"]=$.toJSON(T);if(templateId==13){X["activity.activityType"]=31503}X["activity.awardTips"]=$.toJSON(C);if(N==1){X["rankingSendRule.rankingLine"]=l}if($("#addr_prov").val()!=""){X["playRule.needArea"]=window.save_needArea;X["playRule.areaCode"]=window.save_addressList;X["playRule.province"]=window.save_province;X["playRule.city"]=window.save_city}else{X["playRule.needArea"]=false}X["gamePage.jsonContent"]=genGamePageJson();X["activity.qrcodeUrl"]=genQrcodeEditPageJson();if(X["gamePage.jsonContent"]==false){alert("自定义编辑数据错误，请刷新页面");w.removeClass("disabled");var I=new Image();var O="自定义编辑数据错误："+window.errorTarget;var D="/mobile/newgame/jserror?errorMessage="+O;D+="&scriptURI="+encodeURIComponent(window.location.href);D+="&lineNumber=0";D+="&columnNumber=0";D+="&errorObj="+O;D+="&bowserType="+navigator.userAgent.toLowerCase();D+="&type=0";D+="&_="+new Date().getTime();I.src=D;I.imageSrcKey=D;return}if(X["activity.qrcode_url"]==false){alert("二维码分享页面自定义编辑数据错误，请刷新页面");w.removeClass("disabled");return}if(!!window.addSubmitDataFn&&typeof window.addSubmitDataFn=="function"){window.addSubmitDataFn(X)}if(isEdit&&!isReCreate){X["activity.id"]=global_aid;X["helpRule.activityId"]=global_aid;X["playRule.activityId"]=global_aid;X["challengeSendRule.activityId"]=global_aid;X["challengeSendRule.id"]=window.challengeSendRuleId;X["rankingSendRule.activityId"]=global_aid;X["rankingSendRule.id"]=window.rankingSendRuleId;X["gamePage.id"]=window.actPageId;$.post("/admin/new_activity/updateActivityWithAllInfo",X,function(Y){if(!window.childUpdateFn){w.removeClass("disabled")}if(Y.ret==0){j(global_aid);unbindBeforeUnload();if(window.childUpdateFn&&typeof window.childUpdateFn=="function"){var Z={global_aid:global_aid,"$btn":w,data:Y};window.childUpdateFn(Z);return false}alert("活动修改成功")}else{alert(Y.msg)}})}else{$.post("/admin/new_activity/addActivityWithAllInfo",X,function(aa){if(!window.childSaveFn){w.removeClass("disabled")}var Z="/datacollection/accountClickData?behaviorType=3&gameTemplateId="+pageTemplateId;$.getJSON(Z,function(){});if(aa.ret==0){var Y=aa.model;global_aid=Y.activityId;unbindBeforeUnload();if(window.childSaveFn&&typeof window.childSaveFn=="function"){var ab={model:Y,"$btn":w};window.childSaveFn(ab);return false}alert("活动创建成功");if(_isFromHb){window.location.href="/admin/activity/unpublish.jsp?isHb=true&showActivityId="+Y.activityId}else{window.location.href="/admin/activity/unpublish.jsp?showActivityId="+Y.activityId}}else{alert(aa.msg)}w.removeClass("disabled")},"json")}});$("#label_poster").off("click").on("click",function(){reviewPageWin.addPosterText()});$("#label_bgimg").off("click").on("click",function(){reviewPageWin.triggerQrcodePageBgUpload()});$("#label_logo_tips").tooltip();$("#label_logo_tips").on("click",function(){$$("#qrcode_edit_headimg").toggle();if($$("#qrcode_edit_headimg").css("display")=="none"){$(this).attr("data-original-title","显示")}else{$(this).attr("data-original-title","隐藏")}});$("#label_nickname_tips").tooltip();$("#label_nickname_tips").on("click",function(){if($$("#qrcode_edit_represent_text").css("display")=="none"){$$("#qrcode_edit_represent_text").css("display","inline-block");$(this).attr("data-original-title","隐藏")}else{$$("#qrcode_edit_represent_text").css("display","none");$(this).attr("data-original-title","显示")}});$("#label_actname_tips").tooltip();$("#label_actname_tips").on("click",function(){if($$("#qrcode_edit_title_text").css("display")=="none"){$$("#qrcode_edit_title_text").css("display","inline-block");$(this).attr("data-original-title","隐藏")}else{$$("#qrcode_edit_title_text").css("display","none");$(this).attr("data-original-title","显示")}})});function initQrcodeBindPage(){if($$("#qrcode_edit_represent_text").css("display")=="none"){$("#label_nickname_tips").attr("data-original-title","显示")}else{$("#label_nickname_tips").attr("data-original-title","隐藏")}var a=$$("#qrcode_edit_headimg").data("type");if(a=="1"){$$("#qrcode_edit_headimg").show()}else{$$("#qrcode_edit_headimg").hide()}if($$("#qrcode_edit_headimg").css("display")=="none"){$("#label_logo_tips").attr("data-original-title","显示")}else{$("#label_logo_tips").attr("data-original-title","隐藏")}$.validator.addMethod("defaultWinnerLeftNum",function(e,d,f){var c=Number($("#form_add_defaultwinner_award_setting").find("input[name='defaultwinner_available_num']").val());var b=Number(e);return b>0&&b<=c},"待领取数量不能大于可内定数量")};